{"ast":null,"code":"var _jsxFileName = \"/home/dan1erusam4/.ssh/Website/src/Pages/FainaTree/index.js\",\n    _s = $RefreshSig$();\n\n// example from https://bl.ocks.org/mbostock/3885705\nimport React, { useEffect, useState } from 'react';\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\nimport { faCompress, faExpand, faSitemap, faGripHorizontal, faChevronDown, faChevronUp, faArrowUp, faArrowDown, faAngleLeft, faAngleRight } from \"@fortawesome/free-solid-svg-icons\";\nimport * as d3 from 'd3';\nimport classNames from \"classname\";\nimport data from \"Assets/db.json\";\nimport femalePic from \"Assets/default_profile/female.svg\";\nimport malePic from \"Assets/default_profile/male.svg\";\nimport nei from \"Assets/icons/nei.svg\";\nimport aettua from \"Assets/icons/aettua.svg\";\nimport anzol from \"Assets/icons/anzol.svg\";\nimport sal from \"Assets/icons/sal.svg\";\nimport rol from \"Assets/icons/rol.svg\";\nimport lenco from \"Assets/icons/lenco.svg\";\nimport pa from \"Assets/icons/pa.svg\";\nimport './index.css';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst MIN_YEAR = 10,\n      MAX_YEAR = 21;\nconst organizations = {\n  nei: {\n    name: \"NEI\",\n    insignia: nei\n  },\n  aettua: {\n    name: \"AETTUA\",\n    insignia: aettua\n  },\n  cf: {\n    name: \"Comissão de Faina\",\n    insignia: anzol\n  },\n  cs: {\n    name: \"Conselho do Salgado\",\n    insignia: sal\n  },\n  escrivao: {\n    name: \"Mestre Escrivão\",\n    insignia: rol\n  },\n  pescador: {\n    name: \"Mestre Pescador\",\n    insignia: lenco\n  },\n  salgado: {\n    name: \"Mestre do Salgado\",\n    insignia: pa\n  }\n};\nconst Modes = {\n  TREE: 1,\n  YEAR: 2\n}; // threshold to show photos\n\nconst zoomThreshold = 1;\nlet lastTransform = d3.zoomIdentity.scale(0.5);\nlet svg, zoom, groups, labels, fainaLabels;\n\nfunction separateName(name) {\n  const maxChars = 15,\n        middleIndex = Math.ceil(name.length / 2);\n  let name1 = name.slice(0, middleIndex).split(\" \"),\n      name2 = name.slice(middleIndex).split(\" \"),\n      nameMid = name1.slice(-1)[0] + name2.slice(0, 1)[0];\n  name1 = name1.slice(0, -1).join(\" \");\n  name2 = name2.slice(1).join(\" \");\n\n  if (name1.length >= name2.length) {\n    name2 = (nameMid + \" \" + name2).trim();\n  } else {\n    name1 = (name1 + \" \" + nameMid).trim();\n  }\n\n  let isTruncated = false,\n      tname1 = name1,\n      tname2 = name2;\n\n  if (name1.length > maxChars) {\n    isTruncated = true;\n    tname1 = name1.slice(0, maxChars - 3) + \"...\";\n  }\n\n  if (name2.length > maxChars) {\n    isTruncated = true;\n    tname2 = name2.slice(0, maxChars - 3) + \"...\";\n  }\n\n  return {\n    name1,\n    name2,\n    isTruncated,\n    tname1,\n    tname2\n  };\n}\n\nfunction getFainaHierarchy({\n  sex,\n  start_year,\n  organizations\n}, end_year) {\n  for (const o of organizations) {\n    if (o.name === \"cf\" && o.year === end_year && o.role) return o.role;\n    if (o.name === \"st\" && o.year === end_year) return o.role;\n  }\n\n  const maleHierarchies = [\"Junco\", \"Moço\", \"Marnoto\", \"Mestre\"];\n  const femaleHierarchies = [\"Caniça\", \"Moça\", \"Salineira\", \"Mestre\"];\n  const index = Math.min(end_year - start_year - 1, 3);\n  return sex === \"M\" ? maleHierarchies[index] : femaleHierarchies[index];\n}\n\nfunction showLabelFaina({\n  fainaNames,\n  start_year\n}, end_year) {\n  if (fainaNames && start_year + 1 <= end_year) {\n    return true;\n  }\n\n  return false;\n}\n\nfunction labelFamilies(node) {\n  if (node.parent) {\n    if (node.parent.id === \"000\") {\n      node.family = node.id; // head of the family\n    } else {\n      node.family = node.parent.family;\n    }\n  }\n\n  if (node.children) {\n    node.family_depth = 0;\n    node.family_count = 0;\n\n    for (const n of node.children) {\n      labelFamilies(n);\n      node.family_depth = Math.max(node.family_depth, n.family_depth);\n      node.family_count += n.family_count;\n    }\n  } else {\n    node.family_depth = node.depth;\n    node.family_count = 1;\n  }\n}\n\nfunction buildTree() {\n  const assignInsignias = () => {\n    const insignias = [\"nei\", \"aettua\"];\n    const i = Math.floor(Math.random() * insignias.length * 2);\n    return insignias.slice(i);\n  };\n\n  for (const elem of data.users) {\n    var _elem$organizations;\n\n    elem.names = separateName(elem.name);\n\n    if (elem.faina) {\n      var _elem$faina;\n\n      elem.fainaNames = separateName(getFainaHierarchy(elem, MAX_YEAR) + \" \" + ((_elem$faina = elem.faina) === null || _elem$faina === void 0 ? void 0 : _elem$faina[0].name));\n    }\n\n    elem.insignias = ((_elem$organizations = elem.organizations) === null || _elem$organizations === void 0 ? void 0 : _elem$organizations.map(o => {\n      if (o.name !== \"st\") return o.name;\n      return {\n        \"Mestre Escrivão\": \"escrivao\",\n        \"Mestre Pescador\": \"pescador\",\n        \"Mestre do Salgado\": \"salgado\"\n      }[o.role];\n    }).filter((v, i, a) => a.indexOf(v) === i)) || [];\n  }\n\n  const dataStructure = d3.stratify().id(d => d.id).parentId(d => d.parent)(data.users); // label all nodes with their family id and depth\n\n  labelFamilies(dataStructure); // sort head families according to the family depth\n  // sort like a normal distribution\n\n  dataStructure.children = dataStructure.children.slice().sort((a, b) => a.family_depth - b.family_depth || a.family_count - b.family_count).reduceRight((acc, val, i) => {\n    return i % 2 === 0 ? [...acc, val] : [val, ...acc];\n  }, []);\n  const treeStructure = d3.tree() // .size(view)\n  .nodeSize([100, 150]).separation(function (a, b) {\n    return a.family != b.family ? 4 : a.parent != b.parent ? 1.25 : 1;\n  });\n  const root = treeStructure(dataStructure); // clean svg\n\n  d3.select(\"svg.treeei\").selectAll(\"*:not(defs, defs *)\").remove();\n  zoom = d3.zoom().scaleExtent([0.2, 2]).on(\"zoom\", ({\n    transform\n  }) => zoomed(transform));\n  svg = d3.select(\"svg.treeei\").call(zoom).append(\"g\");\n\n  function zoomed(transform) {\n    const n = transform.k > zoomThreshold;\n    const o = lastTransform.k > zoomThreshold;\n\n    if (n !== o) {\n      updateNodes(n);\n    }\n\n    svg.attr(\"transform\", transform);\n    lastTransform = transform;\n  }\n\n  groups = svg.append(\"g\").attr(\"class\", \"nodes\").selectAll(\"g\").data(root.descendants().slice(1)).enter().append(\"g\"); // links\n\n  groups.filter(d => d.parent != root).append(\"path\").style(\"stroke\", \"silver\").attr('marker-start', 'url(#dot)').attr(\"d\", function (d) {\n    const sx = d.parent.x,\n          sy = d.parent.y + 68,\n          tx = d.x,\n          ty = d.y,\n          hy = 0.5 * (ty - sy),\n          off = 5;\n    let dir = sx - tx > 0 ? -1 : sx - tx < 0 ? 1 : 0;\n    const p = \"M\" + sx + \",\" + sy + \"v\" + (hy - off - 10) + \"c\" + 0 + \",\" + off + \" \" + 0 + \",\" + off + \" \" + off * dir + \",\" + off + \"h\" + (tx - sx - 3 * off * dir) + \"c\" + 2 * off * dir + \",\" + 0 + \" \" + 2 * off * dir + \",\" + 0 + \" \" + 2 * off * dir + \",\" + 2 * off + \"L\" + tx + \",\" + ty;\n    return p;\n  }).attr(\"stroke-dasharray\", function () {\n    let length = d3.select(this).node().getTotalLength();\n    return length + \" \" + length;\n  }).attr(\"stroke-dashoffset\", function () {\n    return d3.select(this).node().getTotalLength();\n  }).transition().duration(3000).ease(d3.easeLinear).attr(\"stroke-dashoffset\", 0);\n  const nodes = groups.append(\"g\").attr(\"class\", \"node\").attr(\"transform\", d => `translate(${d.x},${d.y})`); // node images\n\n  d3.select(\"defs\").selectAll(\"pattern.image\").data(root.descendants().slice(1)).enter().append(\"pattern\").attr(\"id\", d => d.data.id).attr(\"class\", \"image\").attr('width', 1).attr('height', 1).attr('patternContentUnits', 'objectBoundingBox').append(\"image\").attr(\"xlink:xlink:href\", function (d) {\n    return d.data.image ? d.data.image : d.data.sex === \"M\" ? malePic : femalePic;\n  }).attr(\"height\", 1).attr(\"width\", 1).attr(\"preserveAspectRatio\", \"xMinYMin slice\"); // circle with the person image\n\n  const nodesProfilePic = nodes.append(\"circle\").attr(\"class\", \"profile-pic\").attr(\"cx\", 0).attr(\"cy\", 0).attr(\"r\", 10).style(\"fill\", d => `url(#${d.data.id})`);\n  nodes.insert(\"g\", \"circle.profile-pic\").attr(\"class\", \"insignias\").selectAll(\"rect\").data(d => d.data.insignias).enter().append(\"rect\").attr(\"class\", d => `insignia ${d}`).attr(\"x\", -5).attr(\"y\", -5).style(\"opacity\", 0).attr(\"width\", 10).attr(\"height\", 10).style(\"fill\", d => `url(#${d})`); // circle with the gradient year color\n\n  const nodesProfileGrad = nodes.append(\"circle\").attr(\"class\", \"profile-grad\").attr(\"cx\", 0).attr(\"cy\", 0).attr(\"r\", 10).attr(\"opacity\", 1).style(\"cursor\", d => {\n    var _d$data$insignias;\n\n    return ((_d$data$insignias = d.data.insignias) === null || _d$data$insignias === void 0 ? void 0 : _d$data$insignias.length) > 0 ? \"pointer\" : \"default\";\n  }).style(\"fill\", d => d3.schemeTableau10[(d.data.start_year + 6) % 10]).on(\"click\", function (event) {\n    let parent = this.parentElement;\n    let active = parent.classList.contains(\"active\");\n    let x, y, o;\n\n    if (active) {\n      parent.classList.remove(\"active\");\n\n      x = y = _ => -5;\n\n      o = 0;\n    } else {\n      parent.classList.add(\"active\");\n\n      x = i => Math.cos((-i + 1) / 5 * Math.PI) * 30 - 5;\n\n      y = i => Math.sin((-i + 1) / 5 * Math.PI) * 30 - 5;\n\n      o = 1;\n    }\n\n    d3.select(parent).select(\"g.insignias\").selectAll(\"rect.insignia\").transition().attr(\"x\", (d, i) => x(i)).attr(\"y\", (d, i) => y(i)).style(\"opacity\", o).ease(d3.easeBackOut.overshoot(2));\n  }); // border with the year color \n\n  const nodesProfileBorder = nodes.insert(\"circle\", \"circle\").attr(\"class\", \"profile-border\").attr(\"cx\", 0).attr(\"cy\", 0).attr(\"r\", 12).style(\"fill\", \"white\").style(\"stroke\", \"silver\").style(\"stroke-width\", 1.5);\n  labels = groups.append(\"g\").attr(\"class\", \"label\").attr(\"transform\", d => `translate(${d.x},${d.y + 18})`);\n  fainaLabels = labels.filter(d => d.data.fainaNames).classed(\"label-faina\", true); // nodes' names\n\n  labels.append(\"text\").attr(\"x\", 0).attr(\"y\", 0).attr(\"text-anchor\", \"middle\").append(\"tspan\").attr('x', 0).attr('dy', '1.2em').text(d => d.data.names.tname1).append(\"tspan\").attr('x', 0).attr('dy', '1.2em').text(d => d.data.names.tname2); // nodes' faina names\n\n  fainaLabels.append(\"text\").classed(\"text-faina\", true).attr(\"x\", 0).attr(\"y\", 0).attr(\"text-anchor\", \"middle\").append(\"tspan\").attr('x', 0).attr('dy', '1.2em').text(d => d.data.fainaNames.tname1).append(\"tspan\").attr('x', 0).attr('dy', '1.2em').text(d => d.data.fainaNames.tname2);\n  const labelsTooltips = groups.filter(d => d.data.names.isTruncated).append(\"g\").attr(\"class\", \"label label-tooltip\").attr(\"transform\", d => `translate(${d.x},${d.y + 18})`).attr(\"opacity\", \"0\").on('mouseover', function () {\n    d3.select(this).transition().duration(200).attr('opacity', 1);\n  }).on('mouseout', function () {\n    d3.select(this).transition().delay(200).duration(400).attr('opacity', 0);\n  });\n  labelsTooltips.append(\"text\").attr(\"x\", 0).attr(\"y\", 0).attr(\"text-anchor\", \"middle\").append(\"tspan\").attr('x', 0).attr('dy', '1.2em').text(d => d.data.names.name1).append(\"tspan\").attr('x', 0).attr('dy', '1.2em').text(d => d.data.names.name2);\n  labelsTooltips.insert(\"rect\", \"text\").attr(\"fill\", \"white\").attr(\"width\", function () {\n    return this.nextSibling.getBBox().width + 10;\n  }).attr(\"height\", function () {\n    return this.nextSibling.getBBox().height;\n  }).attr(\"x\", function () {\n    return this.nextSibling.getBBox().x - 5;\n  }).attr(\"y\", function () {\n    return this.nextSibling.getBBox().y;\n  });\n\n  function updateNodes(close) {\n    nodesProfilePic.style(\"fill\", d => close ? `url(#${d.data.id})` : \"none\").transition().duration(300).attr(\"r\", close ? 18 : 10);\n    nodesProfileGrad.attr(\"opacity\", d => close ? d.data.image ? 0 : 0.3 : 1).transition().duration(300).attr(\"r\", close ? 18 : 10);\n    nodesProfileBorder.style(\"stroke\", close ? d => d3.schemeTableau10[(d.data.start_year + 6) % 10] : \"silver\").transition().duration(300).attr(\"r\", close ? 20 : 12);\n    labels.classed('label-small', close).transition().duration(300).attr(\"transform\", d => `translate(${d.x},${d.y + (close ? 26 : 18)})`);\n    labelsTooltips.classed('label-small', close).transition().duration(300).attr(\"transform\", d => `translate(${d.x},${d.y + (close ? 26 : 18)})`);\n  }\n\n  updateNodes(false); // constrain tree\n\n  const {\n    width,\n    height,\n    x,\n    y\n  } = svg.node().getBBox();\n  const padY = 256,\n        padX = 768,\n        x0 = x - 1.5 * padX,\n        y0 = y - padY,\n        x1 = x + width + padX,\n        y1 = y + height + padY;\n  zoom.translateExtent([[x0, y0], [x1, y1]]);\n}\n\nfunction centerTree() {\n  const rect = d3.select(\"svg.treeei\").node().getBoundingClientRect();\n  const {\n    x,\n    y,\n    width,\n    height\n  } = svg.node().getBBox();\n  let offsetY = (rect.height - height * lastTransform.k) / 2 - y * lastTransform.k;\n  let offsetX = (rect.width - width * lastTransform.k) / 2 - x * lastTransform.k;\n  d3.select(\"svg.treeei\").call(zoom.transform, d3.zoomIdentity.translate(offsetX, offsetY).scale(0.5));\n}\n\nfunction filterTree(names, end_year) {\n  groups.attr(\"opacity\", d => {\n    if (d.data.start_year > end_year) return 0.2;\n    if (names.length === 0) return 1;\n    if (d.data.insignias.some(n => names.includes(n))) return 1;\n    return 0.2;\n  });\n  fainaLabels.filter(function (d) {\n    const n = d3.select(this);\n\n    if (showLabelFaina(d.data, end_year)) {\n      var _d$data$faina;\n\n      const hierarchy = getFainaHierarchy(d.data, end_year);\n      d.data.fainaNames = separateName(hierarchy + \" \" + ((_d$data$faina = d.data.faina) === null || _d$data$faina === void 0 ? void 0 : _d$data$faina[0].name));\n      n.classed(\"label-faina\", true);\n      return true;\n    }\n\n    n.classed(\"label-faina\", false);\n    return false;\n  }).select('text.text-faina').select(\"tspan\").text(d => d.data.fainaNames.tname1).append(\"tspan\").attr('x', 0).attr('dy', '1.2em').text(d => d.data.fainaNames.tname2);\n}\n\nfunction changeLabels(showFainaNames) {\n  fainaLabels.classed(\"show\", showFainaNames);\n}\n\nfunction FainaTree() {\n  _s();\n\n  const [showInfo, setShowInfo] = useState(false);\n  const [expanded, setExpanded] = useState(false);\n  const [mode, setMode] = useState(Modes.TREE);\n  const [endYear, setEndYear] = useState(MAX_YEAR);\n  const [insignias, setInsignias] = useState([]);\n  const [year, setYear] = useState(MAX_YEAR);\n  const [fainaNames, setFainaNames] = useState(false);\n\n  const toggleShowInfo = () => {\n    setShowInfo(!showInfo);\n  };\n\n  const toggleExpand = () => {\n    setExpanded(!expanded);\n  };\n\n  const toggleMode = () => {\n    setMode(mode === Modes.TREE ? Modes.FAINA : Modes.TREE);\n  };\n\n  const toggeFainaNames = () => {\n    changeLabels(!fainaNames);\n    setFainaNames(!fainaNames);\n  };\n\n  const toggleInsignias = name => {\n    const i = insignias.indexOf(name);\n    if (i !== -1) insignias.splice(i, 1);else insignias.push(name);\n    setInsignias([...insignias]);\n  };\n\n  useEffect(() => {\n    buildTree();\n    centerTree();\n  }, []);\n  useEffect(() => {\n    filterTree(insignias, year);\n  }, [insignias, year]);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    id: \"treeei\",\n    className: classNames(\"d-flex flex-grow-1\", {\n      \"expand\": expanded\n    }),\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"side-bar\",\n      children: [/*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"side-bar-button\",\n        onClick: toggleShowInfo,\n        children: /*#__PURE__*/_jsxDEV(\"span\", {\n          children: /*#__PURE__*/_jsxDEV(FontAwesomeIcon, {\n            icon: showInfo ? faAngleLeft : faAngleRight,\n            size: \"sm\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 606,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 605,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 604,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: classNames(\"side-bar-body\", {\n          \"hide\": !showInfo\n        }),\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"side-bar-content\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"mb-3\",\n            children: /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"d-flex align-items-center justify-content-around\",\n              style: {\n                minHeight: 32\n              },\n              children: [/*#__PURE__*/_jsxDEV(FontAwesomeIcon, {\n                onClick: toggleExpand,\n                className: \"menu-icon\",\n                icon: expanded ? faCompress : faExpand,\n                size: \"lg\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 615,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(FontAwesomeIcon, {\n                style: {\n                  cursor: \"not-allowed\",\n                  opacity: 0.25\n                },\n                onClick: toggleMode,\n                className: \"menu-icon\",\n                icon: mode === Modes.TREE ? faGripHorizontal : faSitemap,\n                size: mode === Modes.TREE ? \"2x\" : \"lg\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 620,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 614,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 613,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"h4\", {\n            children: \"Matr\\xEDculas\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 628,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"d-flex justify-content-between my-3\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"mr-3\",\n              children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                style: {\n                  marginBottom: \"0.2em\"\n                },\n                children: /*#__PURE__*/_jsxDEV(FontAwesomeIcon, {\n                  onClick: () => setEndYear(endYear => Math.max(--endYear, MIN_YEAR + 9)),\n                  style: endYear === MIN_YEAR + 9 ? {\n                    opacity: 0.5\n                  } : {\n                    cursor: \"pointer\"\n                  },\n                  icon: faArrowUp,\n                  size: \"sm\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 632,\n                  columnNumber: 19\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 631,\n                columnNumber: 17\n              }, this), [...Array(5).keys()].map(i => endYear - 9 + i).map(i => /*#__PURE__*/_jsxDEV(\"div\", {\n                className: classNames(\"color-legend\", {\n                  \"inactive\": i > year\n                }),\n                onClick: () => setYear(i),\n                children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"color-bullet\",\n                  style: {\n                    backgroundColor: d3.schemeTableau10[(i + 6) % 10]\n                  }\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 643,\n                  columnNumber: 23\n                }, this), 2000 + i]\n              }, i, true, {\n                fileName: _jsxFileName,\n                lineNumber: 640,\n                columnNumber: 21\n              }, this))]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 630,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"mr-3\",\n              children: [[...Array(5).keys()].map(i => endYear - 4 + i).map(i => /*#__PURE__*/_jsxDEV(\"div\", {\n                className: classNames(\"color-legend\", {\n                  \"inactive\": i > year\n                }),\n                onClick: () => setYear(i),\n                children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"color-bullet\",\n                  style: {\n                    backgroundColor: d3.schemeTableau10[(i + 6) % 10]\n                  }\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 656,\n                  columnNumber: 23\n                }, this), 2000 + i]\n              }, i, true, {\n                fileName: _jsxFileName,\n                lineNumber: 653,\n                columnNumber: 21\n              }, this)), /*#__PURE__*/_jsxDEV(\"div\", {\n                style: {\n                  marginBottom: \"0.2em\"\n                },\n                children: /*#__PURE__*/_jsxDEV(FontAwesomeIcon, {\n                  onClick: () => setEndYear(endYear => Math.min(++endYear, MAX_YEAR)),\n                  style: endYear === MAX_YEAR ? {\n                    opacity: 0.5\n                  } : {\n                    cursor: \"pointer\"\n                  },\n                  icon: faArrowDown,\n                  size: \"sm\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 663,\n                  columnNumber: 19\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 662,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 650,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 629,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"h4\", {\n            children: \"Ins\\xEDgnias\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 672,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"mr-auto mt-3\",\n            children: Object.entries(organizations).map(([key, org]) => /*#__PURE__*/_jsxDEV(\"div\", {\n              className: classNames(\"insignia\", {\n                \"inactive\": insignias.length !== 0 && !insignias.includes(key)\n              }),\n              onClick: () => toggleInsignias(key),\n              children: [/*#__PURE__*/_jsxDEV(\"img\", {\n                src: org.insignia\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 678,\n                columnNumber: 21\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                children: org.name\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 679,\n                columnNumber: 21\n              }, this)]\n            }, key, true, {\n              fileName: _jsxFileName,\n              lineNumber: 676,\n              columnNumber: 19\n            }, this))\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 673,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"h4\", {\n            children: \"Nomes\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 684,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"mt-3\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"mb-2\",\n              style: {\n                fontWeight: 300,\n                opacity: 0.7,\n                textDecoration: \"line-through\",\n                cursor: \"default\"\n              },\n              children: \"Mostrar apelidos\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 686,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"mb-2\",\n              style: {\n                fontWeight: fainaNames ? 400 : 300,\n                opacity: fainaNames ? 1 : 0.7,\n                cursor: \"pointer\"\n              },\n              onClick: toggeFainaNames,\n              children: \"Mostrar nomes de faina\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 691,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 685,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 612,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 611,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 603,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"svg\", {\n      className: \"treeei\",\n      children: /*#__PURE__*/_jsxDEV(\"defs\", {\n        children: [/*#__PURE__*/_jsxDEV(\"marker\", {\n          id: \"dot\",\n          viewBox: \"0,0,20,20\",\n          refX: \"10\",\n          refY: \"10\",\n          markerWidth: \"10\",\n          markerHeight: \"10\",\n          children: /*#__PURE__*/_jsxDEV(\"circle\", {\n            cx: \"10\",\n            cy: \"10\",\n            r: \"4\",\n            fill: \"silver\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 704,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 703,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"filter\", {\n          id: \"drop-shadow2\",\n          height: \"130%\",\n          children: [/*#__PURE__*/_jsxDEV(\"feGaussianBlur\", {\n            in: \"SourceAlpha\",\n            stdDeviation: \"5\",\n            result: \"blur\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 707,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"feOffset\", {\n            in: \"blur\",\n            dx: \"5\",\n            dy: \"5\",\n            result: \"offsetBlur\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 708,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"feMerge\", {\n            children: [/*#__PURE__*/_jsxDEV(\"feMergeNode\", {\n              in: \"offsetBlur\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 710,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"feMergeNode\", {\n              in: \"SourceGraphic\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 711,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 709,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 706,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"filter\", {\n          id: \"drop-shadow\",\n          filterUnits: \"userSpaceOnUse\",\n          width: \"250%\",\n          height: \"250%\",\n          children: [/*#__PURE__*/_jsxDEV(\"feGaussianBlur\", {\n            in: \"SourceGraphic\",\n            stdDeviation: \"2\",\n            result: \"blur-out\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 715,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"feOffset\", {\n            in: \"color-out\",\n            dx: \"1\",\n            dy: \"1\",\n            result: \"the-shadow\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 717,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"feOffset\", {\n            in: \"color-out\",\n            dx: \"-1\",\n            dy: \"-1\",\n            result: \"the-shadow\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 718,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"feBlend\", {\n            in: \"SourceGraphic\",\n            in2: \"the-shadow\",\n            mode: \"normal\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 719,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 714,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"pattern\", {\n          id: \"default_male\",\n          width: \"1\",\n          height: \"1\",\n          patternContentUnits: \"objectBoundingBox\",\n          children: /*#__PURE__*/_jsxDEV(\"image\", {\n            xlinkHref: malePic,\n            height: \"1\",\n            width: \"1\",\n            preserveAspectRatio: \"xMinYMin slice\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 722,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 721,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"pattern\", {\n          id: \"default_female\",\n          width: \"1\",\n          height: \"1\",\n          patternContentUnits: \"objectBoundingBox\",\n          children: /*#__PURE__*/_jsxDEV(\"image\", {\n            xlinkHref: femalePic,\n            height: \"1\",\n            width: \"1\",\n            preserveAspectRatio: \"xMinYMin slice\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 725,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 724,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"pattern\", {\n          id: \"nei\",\n          width: \"1\",\n          height: \"1\",\n          patternContentUnits: \"objectBoundingBox\",\n          children: /*#__PURE__*/_jsxDEV(\"image\", {\n            xlinkHref: nei,\n            height: \"1\",\n            width: \"1\",\n            preserveAspectRatio: \"xMinYMin slice\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 728,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 727,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"pattern\", {\n          id: \"aettua\",\n          width: \"1\",\n          height: \"1\",\n          patternContentUnits: \"objectBoundingBox\",\n          children: /*#__PURE__*/_jsxDEV(\"image\", {\n            xlinkHref: aettua,\n            height: \"1\",\n            width: \"1\",\n            preserveAspectRatio: \"xMinYMin slice\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 731,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 730,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"pattern\", {\n          id: \"cf\",\n          width: \"1\",\n          height: \"1\",\n          patternContentUnits: \"objectBoundingBox\",\n          children: /*#__PURE__*/_jsxDEV(\"image\", {\n            xlinkHref: anzol,\n            height: \"1\",\n            width: \"1\",\n            preserveAspectRatio: \"xMinYMin slice\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 734,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 733,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"pattern\", {\n          id: \"cs\",\n          width: \"1\",\n          height: \"1\",\n          patternContentUnits: \"objectBoundingBox\",\n          children: /*#__PURE__*/_jsxDEV(\"image\", {\n            xlinkHref: sal,\n            height: \"1\",\n            width: \"1\",\n            preserveAspectRatio: \"xMinYMin slice\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 737,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 736,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"pattern\", {\n          id: \"escrivao\",\n          width: \"1\",\n          height: \"1\",\n          patternContentUnits: \"objectBoundingBox\",\n          children: /*#__PURE__*/_jsxDEV(\"image\", {\n            xlinkHref: rol,\n            height: \"1\",\n            width: \"1\",\n            preserveAspectRatio: \"xMinYMin slice\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 740,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 739,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"pattern\", {\n          id: \"pescador\",\n          width: \"1\",\n          height: \"1\",\n          patternContentUnits: \"objectBoundingBox\",\n          children: /*#__PURE__*/_jsxDEV(\"image\", {\n            xlinkHref: lenco,\n            height: \"1\",\n            width: \"1\",\n            preserveAspectRatio: \"xMinYMin slice\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 743,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 742,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"pattern\", {\n          id: \"salgado\",\n          width: \"1\",\n          height: \"1\",\n          patternContentUnits: \"objectBoundingBox\",\n          children: /*#__PURE__*/_jsxDEV(\"image\", {\n            xlinkHref: pa,\n            height: \"1\",\n            width: \"1\",\n            preserveAspectRatio: \"xMinYMin slice\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 746,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 745,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 702,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 701,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 602,\n    columnNumber: 5\n  }, this);\n}\n\n_s(FainaTree, \"aAwt0SJY9f8OxqExERS1qS/9GSA=\");\n\n_c = FainaTree;\nexport default FainaTree;\n\nvar _c;\n\n$RefreshReg$(_c, \"FainaTree\");","map":{"version":3,"sources":["/home/dan1erusam4/.ssh/Website/src/Pages/FainaTree/index.js"],"names":["React","useEffect","useState","FontAwesomeIcon","faCompress","faExpand","faSitemap","faGripHorizontal","faChevronDown","faChevronUp","faArrowUp","faArrowDown","faAngleLeft","faAngleRight","d3","classNames","data","MIN_YEAR","MAX_YEAR","organizations","nei","name","insignia","aettua","cf","anzol","cs","sal","escrivao","rol","pescador","lenco","salgado","pa","Modes","TREE","YEAR","zoomThreshold","lastTransform","zoomIdentity","scale","svg","zoom","groups","labels","fainaLabels","separateName","maxChars","middleIndex","Math","ceil","length","name1","slice","split","name2","nameMid","join","trim","isTruncated","tname1","tname2","getFainaHierarchy","sex","start_year","end_year","o","year","role","maleHierarchies","femaleHierarchies","index","min","showLabelFaina","fainaNames","labelFamilies","node","parent","id","family","children","family_depth","family_count","n","max","depth","buildTree","assignInsignias","insignias","i","floor","random","elem","users","names","faina","map","filter","v","a","indexOf","dataStructure","stratify","d","parentId","sort","b","reduceRight","acc","val","treeStructure","tree","nodeSize","separation","root","select","selectAll","remove","scaleExtent","on","transform","zoomed","call","append","k","updateNodes","attr","descendants","enter","style","sx","x","sy","y","tx","ty","hy","off","dir","p","getTotalLength","transition","duration","ease","easeLinear","nodes","image","malePic","femalePic","nodesProfilePic","insert","nodesProfileGrad","schemeTableau10","event","parentElement","active","classList","contains","_","add","cos","PI","sin","easeBackOut","overshoot","nodesProfileBorder","classed","text","labelsTooltips","delay","nextSibling","getBBox","width","height","close","padY","padX","x0","y0","x1","y1","translateExtent","centerTree","rect","getBoundingClientRect","offsetY","offsetX","translate","filterTree","some","includes","hierarchy","changeLabels","showFainaNames","FainaTree","showInfo","setShowInfo","expanded","setExpanded","mode","setMode","endYear","setEndYear","setInsignias","setYear","setFainaNames","toggleShowInfo","toggleExpand","toggleMode","FAINA","toggeFainaNames","toggleInsignias","splice","push","minHeight","cursor","opacity","marginBottom","Array","keys","backgroundColor","Object","entries","key","org","fontWeight","textDecoration"],"mappings":";;;AAAA;AAEA,OAAOA,KAAP,IAAgBC,SAAhB,EAA2BC,QAA3B,QAA2C,OAA3C;AACA,SAASC,eAAT,QAAgC,gCAAhC;AACA,SACEC,UADF,EACcC,QADd,EAEEC,SAFF,EAEaC,gBAFb,EAGEC,aAHF,EAGiBC,WAHjB,EAIEC,SAJF,EAIaC,WAJb,EAKEC,WALF,EAKeC,YALf,QAMO,mCANP;AAQA,OAAO,KAAKC,EAAZ,MAAoB,IAApB;AACA,OAAOC,UAAP,MAAuB,WAAvB;AAEA,OAAOC,IAAP,MAAiB,gBAAjB;;;;;;;;;;AAWA,OAAO,aAAP;;AAGA,MAAMC,QAAQ,GAAG,EAAjB;AAAA,MAAqBC,QAAQ,GAAG,EAAhC;AAEA,MAAMC,aAAa,GAAG;AACpBC,EAAAA,GAAG,EAAE;AACHC,IAAAA,IAAI,EAAE,KADH;AAEHC,IAAAA,QAAQ,EAAEF;AAFP,GADe;AAKpBG,EAAAA,MAAM,EAAE;AACNF,IAAAA,IAAI,EAAE,QADA;AAENC,IAAAA,QAAQ,EAAEC;AAFJ,GALY;AASpBC,EAAAA,EAAE,EAAE;AACFH,IAAAA,IAAI,EAAE,mBADJ;AAEFC,IAAAA,QAAQ,EAAEG;AAFR,GATgB;AAapBC,EAAAA,EAAE,EAAE;AACFL,IAAAA,IAAI,EAAE,qBADJ;AAEFC,IAAAA,QAAQ,EAAEK;AAFR,GAbgB;AAiBpBC,EAAAA,QAAQ,EAAE;AACRP,IAAAA,IAAI,EAAE,iBADE;AAERC,IAAAA,QAAQ,EAAEO;AAFF,GAjBU;AAqBpBC,EAAAA,QAAQ,EAAE;AACRT,IAAAA,IAAI,EAAE,iBADE;AAERC,IAAAA,QAAQ,EAAES;AAFF,GArBU;AAyBpBC,EAAAA,OAAO,EAAE;AACPX,IAAAA,IAAI,EAAE,mBADC;AAEPC,IAAAA,QAAQ,EAAEW;AAFH;AAzBW,CAAtB;AA+BA,MAAMC,KAAK,GAAG;AACZC,EAAAA,IAAI,EAAE,CADM;AAEZC,EAAAA,IAAI,EAAE;AAFM,CAAd,C,CAMA;;AACA,MAAMC,aAAa,GAAG,CAAtB;AACA,IAAIC,aAAa,GAAGxB,EAAE,CAACyB,YAAH,CAAgBC,KAAhB,CAAsB,GAAtB,CAApB;AACA,IAAIC,GAAJ,EAASC,IAAT,EAAeC,MAAf,EAAuBC,MAAvB,EAA+BC,WAA/B;;AAGA,SAASC,YAAT,CAAsBzB,IAAtB,EAA4B;AAC1B,QAAM0B,QAAQ,GAAG,EAAjB;AAAA,QACEC,WAAW,GAAGC,IAAI,CAACC,IAAL,CAAU7B,IAAI,CAAC8B,MAAL,GAAc,CAAxB,CADhB;AAGA,MAAIC,KAAK,GAAG/B,IAAI,CAACgC,KAAL,CAAW,CAAX,EAAcL,WAAd,EAA2BM,KAA3B,CAAiC,GAAjC,CAAZ;AAAA,MACEC,KAAK,GAAGlC,IAAI,CAACgC,KAAL,CAAWL,WAAX,EAAwBM,KAAxB,CAA8B,GAA9B,CADV;AAAA,MAEEE,OAAO,GAAGJ,KAAK,CAACC,KAAN,CAAY,CAAC,CAAb,EAAgB,CAAhB,IAAqBE,KAAK,CAACF,KAAN,CAAY,CAAZ,EAAe,CAAf,EAAkB,CAAlB,CAFjC;AAIAD,EAAAA,KAAK,GAAGA,KAAK,CAACC,KAAN,CAAY,CAAZ,EAAe,CAAC,CAAhB,EAAmBI,IAAnB,CAAwB,GAAxB,CAAR;AACAF,EAAAA,KAAK,GAAGA,KAAK,CAACF,KAAN,CAAY,CAAZ,EAAeI,IAAf,CAAoB,GAApB,CAAR;;AAEA,MAAIL,KAAK,CAACD,MAAN,IAAgBI,KAAK,CAACJ,MAA1B,EAAkC;AAChCI,IAAAA,KAAK,GAAG,CAACC,OAAO,GAAG,GAAV,GAAgBD,KAAjB,EAAwBG,IAAxB,EAAR;AACD,GAFD,MAEO;AACLN,IAAAA,KAAK,GAAG,CAACA,KAAK,GAAG,GAAR,GAAcI,OAAf,EAAwBE,IAAxB,EAAR;AACD;;AAED,MAAIC,WAAW,GAAG,KAAlB;AAAA,MACEC,MAAM,GAAGR,KADX;AAAA,MAEES,MAAM,GAAGN,KAFX;;AAIA,MAAIH,KAAK,CAACD,MAAN,GAAeJ,QAAnB,EAA6B;AAC3BY,IAAAA,WAAW,GAAG,IAAd;AACAC,IAAAA,MAAM,GAAGR,KAAK,CAACC,KAAN,CAAY,CAAZ,EAAeN,QAAQ,GAAG,CAA1B,IAA+B,KAAxC;AACD;;AACD,MAAIQ,KAAK,CAACJ,MAAN,GAAeJ,QAAnB,EAA6B;AAC3BY,IAAAA,WAAW,GAAG,IAAd;AACAE,IAAAA,MAAM,GAAGN,KAAK,CAACF,KAAN,CAAY,CAAZ,EAAeN,QAAQ,GAAG,CAA1B,IAA+B,KAAxC;AACD;;AAED,SAAO;AAAEK,IAAAA,KAAF;AAASG,IAAAA,KAAT;AAAgBI,IAAAA,WAAhB;AAA6BC,IAAAA,MAA7B;AAAqCC,IAAAA;AAArC,GAAP;AACD;;AAGD,SAASC,iBAAT,CAA2B;AAAEC,EAAAA,GAAF;AAAOC,EAAAA,UAAP;AAAmB7C,EAAAA;AAAnB,CAA3B,EAA+D8C,QAA/D,EAAyE;AACvE,OAAK,MAAMC,CAAX,IAAgB/C,aAAhB,EAA+B;AAC7B,QAAI+C,CAAC,CAAC7C,IAAF,KAAW,IAAX,IAAmB6C,CAAC,CAACC,IAAF,KAAWF,QAA9B,IAA0CC,CAAC,CAACE,IAAhD,EAAsD,OAAOF,CAAC,CAACE,IAAT;AACtD,QAAIF,CAAC,CAAC7C,IAAF,KAAW,IAAX,IAAmB6C,CAAC,CAACC,IAAF,KAAWF,QAAlC,EAA4C,OAAOC,CAAC,CAACE,IAAT;AAC7C;;AAED,QAAMC,eAAe,GAAG,CAAC,OAAD,EAAU,MAAV,EAAkB,SAAlB,EAA6B,QAA7B,CAAxB;AACA,QAAMC,iBAAiB,GAAG,CAAC,QAAD,EAAW,MAAX,EAAmB,WAAnB,EAAgC,QAAhC,CAA1B;AAEA,QAAMC,KAAK,GAAGtB,IAAI,CAACuB,GAAL,CAASP,QAAQ,GAAGD,UAAX,GAAwB,CAAjC,EAAoC,CAApC,CAAd;AACA,SAAQD,GAAG,KAAK,GAAT,GAAgBM,eAAe,CAACE,KAAD,CAA/B,GAAyCD,iBAAiB,CAACC,KAAD,CAAjE;AACD;;AAGD,SAASE,cAAT,CAAwB;AAAEC,EAAAA,UAAF;AAAcV,EAAAA;AAAd,CAAxB,EAAoDC,QAApD,EAA8D;AAC5D,MAAIS,UAAU,IAAIV,UAAU,GAAG,CAAb,IAAkBC,QAApC,EAA8C;AAC5C,WAAO,IAAP;AACD;;AACD,SAAO,KAAP;AACD;;AAGD,SAASU,aAAT,CAAuBC,IAAvB,EAA6B;AAC3B,MAAIA,IAAI,CAACC,MAAT,EAAiB;AACf,QAAID,IAAI,CAACC,MAAL,CAAYC,EAAZ,KAAmB,KAAvB,EAA8B;AAC5BF,MAAAA,IAAI,CAACG,MAAL,GAAcH,IAAI,CAACE,EAAnB,CAD4B,CACA;AAC7B,KAFD,MAEO;AACLF,MAAAA,IAAI,CAACG,MAAL,GAAcH,IAAI,CAACC,MAAL,CAAYE,MAA1B;AACD;AACF;;AAED,MAAIH,IAAI,CAACI,QAAT,EAAmB;AACjBJ,IAAAA,IAAI,CAACK,YAAL,GAAoB,CAApB;AACAL,IAAAA,IAAI,CAACM,YAAL,GAAoB,CAApB;;AACA,SAAK,MAAMC,CAAX,IAAgBP,IAAI,CAACI,QAArB,EAA+B;AAC7BL,MAAAA,aAAa,CAACQ,CAAD,CAAb;AACAP,MAAAA,IAAI,CAACK,YAAL,GAAoBhC,IAAI,CAACmC,GAAL,CAASR,IAAI,CAACK,YAAd,EAA4BE,CAAC,CAACF,YAA9B,CAApB;AACAL,MAAAA,IAAI,CAACM,YAAL,IAAqBC,CAAC,CAACD,YAAvB;AACD;AACF,GARD,MAQO;AACLN,IAAAA,IAAI,CAACK,YAAL,GAAoBL,IAAI,CAACS,KAAzB;AACAT,IAAAA,IAAI,CAACM,YAAL,GAAoB,CAApB;AACD;AACF;;AAGD,SAASI,SAAT,GAAqB;AACnB,QAAMC,eAAe,GAAG,MAAM;AAC5B,UAAMC,SAAS,GAAG,CAAC,KAAD,EAAQ,QAAR,CAAlB;AACA,UAAMC,CAAC,GAAGxC,IAAI,CAACyC,KAAL,CAAWzC,IAAI,CAAC0C,MAAL,KAAgBH,SAAS,CAACrC,MAA1B,GAAmC,CAA9C,CAAV;AACA,WAAOqC,SAAS,CAACnC,KAAV,CAAgBoC,CAAhB,CAAP;AACD,GAJD;;AAMA,OAAK,MAAMG,IAAX,IAAmB5E,IAAI,CAAC6E,KAAxB,EAA+B;AAAA;;AAC7BD,IAAAA,IAAI,CAACE,KAAL,GAAahD,YAAY,CAAC8C,IAAI,CAACvE,IAAN,CAAzB;;AACA,QAAIuE,IAAI,CAACG,KAAT,EAAgB;AAAA;;AACdH,MAAAA,IAAI,CAAClB,UAAL,GAAkB5B,YAAY,CAC5BgB,iBAAiB,CAAC8B,IAAD,EAAO1E,QAAP,CAAjB,GAAoC,GAApC,mBAA0C0E,IAAI,CAACG,KAA/C,gDAA0C,YAAa,CAAb,EAAgB1E,IAA1D,CAD4B,CAA9B;AAED;;AACDuE,IAAAA,IAAI,CAACJ,SAAL,GAAiB,wBAAAI,IAAI,CAACzE,aAAL,4EAAoB6E,GAApB,CAAwB9B,CAAC,IAAI;AAC5C,UAAIA,CAAC,CAAC7C,IAAF,KAAW,IAAf,EACE,OAAO6C,CAAC,CAAC7C,IAAT;AACF,aAAO;AACL,2BAAmB,UADd;AAEL,2BAAmB,UAFd;AAGL,6BAAqB;AAHhB,QAIL6C,CAAC,CAACE,IAJG,CAAP;AAKD,KARgB,EAQd6B,MARc,CAQP,CAACC,CAAD,EAAIT,CAAJ,EAAOU,CAAP,KAAaA,CAAC,CAACC,OAAF,CAAUF,CAAV,MAAiBT,CARvB,MAQ6B,EAR9C;AASD;;AAED,QAAMY,aAAa,GAAGvF,EAAE,CAACwF,QAAH,GACnBxB,EADmB,CAChByB,CAAC,IAAIA,CAAC,CAACzB,EADS,EAEnB0B,QAFmB,CAEVD,CAAC,IAAIA,CAAC,CAAC1B,MAFG,EAGnB7D,IAAI,CAAC6E,KAHc,CAAtB,CAxBmB,CA6BnB;;AACAlB,EAAAA,aAAa,CAAC0B,aAAD,CAAb,CA9BmB,CAgCnB;AACA;;AACAA,EAAAA,aAAa,CAACrB,QAAd,GAAyBqB,aAAa,CAACrB,QAAd,CAAuB3B,KAAvB,GACtBoD,IADsB,CACjB,CAACN,CAAD,EAAIO,CAAJ,KAAUP,CAAC,CAAClB,YAAF,GAAiByB,CAAC,CAACzB,YAAnB,IAAmCkB,CAAC,CAACjB,YAAF,GAAiBwB,CAAC,CAACxB,YAD/C,EAEtByB,WAFsB,CAEV,CAACC,GAAD,EAAMC,GAAN,EAAWpB,CAAX,KAAiB;AAC5B,WAAOA,CAAC,GAAG,CAAJ,KAAU,CAAV,GAAc,CAAC,GAAGmB,GAAJ,EAASC,GAAT,CAAd,GAA8B,CAACA,GAAD,EAAM,GAAGD,GAAT,CAArC;AACD,GAJsB,EAIpB,EAJoB,CAAzB;AAMA,QAAME,aAAa,GAAGhG,EAAE,CAACiG,IAAH,GACpB;AADoB,GAEnBC,QAFmB,CAEV,CAAC,GAAD,EAAM,GAAN,CAFU,EAGnBC,UAHmB,CAGR,UAAUd,CAAV,EAAaO,CAAb,EAAgB;AAC1B,WAAOP,CAAC,CAACpB,MAAF,IAAY2B,CAAC,CAAC3B,MAAd,GAAuB,CAAvB,GAA2BoB,CAAC,CAACtB,MAAF,IAAY6B,CAAC,CAAC7B,MAAd,GAAuB,IAAvB,GAA8B,CAAhE;AACD,GALmB,CAAtB;AAOA,QAAMqC,IAAI,GAAGJ,aAAa,CAACT,aAAD,CAA1B,CA/CmB,CAiDnB;;AACAvF,EAAAA,EAAE,CAACqG,MAAH,CAAU,YAAV,EACGC,SADH,CACa,qBADb,EAEGC,MAFH;AAIA3E,EAAAA,IAAI,GAAG5B,EAAE,CAAC4B,IAAH,GACJ4E,WADI,CACQ,CAAC,GAAD,EAAM,CAAN,CADR,EAEJC,EAFI,CAED,MAFC,EAEO,CAAC;AAAEC,IAAAA;AAAF,GAAD,KAAmBC,MAAM,CAACD,SAAD,CAFhC,CAAP;AAIA/E,EAAAA,GAAG,GAAG3B,EAAE,CAACqG,MAAH,CAAU,YAAV,EACHO,IADG,CACEhF,IADF,EAEHiF,MAFG,CAEI,GAFJ,CAAN;;AAIA,WAASF,MAAT,CAAgBD,SAAhB,EAA2B;AACzB,UAAMrC,CAAC,GAAGqC,SAAS,CAACI,CAAV,GAAcvF,aAAxB;AACA,UAAM6B,CAAC,GAAG5B,aAAa,CAACsF,CAAd,GAAkBvF,aAA5B;;AACA,QAAI8C,CAAC,KAAKjB,CAAV,EAAa;AACX2D,MAAAA,WAAW,CAAC1C,CAAD,CAAX;AACD;;AACD1C,IAAAA,GAAG,CAACqF,IAAJ,CAAS,WAAT,EAAsBN,SAAtB;AACAlF,IAAAA,aAAa,GAAGkF,SAAhB;AACD;;AAED7E,EAAAA,MAAM,GAAGF,GAAG,CACTkF,MADM,CACC,GADD,EAENG,IAFM,CAED,OAFC,EAEQ,OAFR,EAGNV,SAHM,CAGI,GAHJ,EAINpG,IAJM,CAIDkG,IAAI,CAACa,WAAL,GAAmB1E,KAAnB,CAAyB,CAAzB,CAJC,EAKN2E,KALM,GAMNL,MANM,CAMC,GAND,CAAT,CAxEmB,CAgFnB;;AACAhF,EAAAA,MAAM,CACHsD,MADH,CACUM,CAAC,IAAIA,CAAC,CAAC1B,MAAF,IAAYqC,IAD3B,EAEGS,MAFH,CAEU,MAFV,EAGGM,KAHH,CAGS,QAHT,EAGmB,QAHnB,EAIGH,IAJH,CAIQ,cAJR,EAIwB,WAJxB,EAKGA,IALH,CAKQ,GALR,EAKa,UAAUvB,CAAV,EAAa;AACtB,UAAM2B,EAAE,GAAG3B,CAAC,CAAC1B,MAAF,CAASsD,CAApB;AAAA,UACEC,EAAE,GAAG7B,CAAC,CAAC1B,MAAF,CAASwD,CAAT,GAAa,EADpB;AAAA,UAEEC,EAAE,GAAG/B,CAAC,CAAC4B,CAFT;AAAA,UAGEI,EAAE,GAAGhC,CAAC,CAAC8B,CAHT;AAAA,UAIEG,EAAE,GAAG,OAAOD,EAAE,GAAGH,EAAZ,CAJP;AAAA,UAKEK,GAAG,GAAG,CALR;AAOA,QAAIC,GAAG,GAAGR,EAAE,GAAGI,EAAL,GAAU,CAAV,GAAc,CAAC,CAAf,GAAmBJ,EAAE,GAAGI,EAAL,GAAU,CAAV,GAAc,CAAd,GAAkB,CAA/C;AAEA,UAAMK,CAAC,GAAI,MAAMT,EAAN,GAAW,GAAX,GAAkBE,EAAlB,GACP,GADO,IACAI,EAAE,GAAGC,GAAL,GAAW,EADX,IAEP,GAFO,GAED,CAFC,GAEG,GAFH,GAESA,GAFT,GAGP,GAHO,GAGD,CAHC,GAGG,GAHH,GAGSA,GAHT,GAIP,GAJO,GAIAA,GAAG,GAAGC,GAJN,GAIa,GAJb,GAImBD,GAJnB,GAKP,GALO,IAKAH,EAAE,GAAGJ,EAAL,GAAU,IAAIO,GAAJ,GAAUC,GALpB,IAMP,GANO,GAMA,IAAID,GAAJ,GAAUC,GANV,GAMiB,GANjB,GAMuB,CANvB,GAOP,GAPO,GAOA,IAAID,GAAJ,GAAUC,GAPV,GAOiB,GAPjB,GAOuB,CAPvB,GAQP,GARO,GAQA,IAAID,GAAJ,GAAUC,GARV,GAQiB,GARjB,GAQuB,IAAID,GAR3B,GASP,GATO,GASDH,EATC,GASI,GATJ,GASUC,EATrB;AAWA,WAAOI,CAAP;AACD,GA3BH,EA4BGb,IA5BH,CA4BQ,kBA5BR,EA4B4B,YAAY;AACpC,QAAI3E,MAAM,GAAGrC,EAAE,CAACqG,MAAH,CAAU,IAAV,EAAgBvC,IAAhB,GAAuBgE,cAAvB,EAAb;AACA,WAAOzF,MAAM,GAAG,GAAT,GAAeA,MAAtB;AACD,GA/BH,EAgCG2E,IAhCH,CAgCQ,mBAhCR,EAgC6B,YAAY;AACrC,WAAOhH,EAAE,CAACqG,MAAH,CAAU,IAAV,EAAgBvC,IAAhB,GAAuBgE,cAAvB,EAAP;AACD,GAlCH,EAmCGC,UAnCH,GAoCGC,QApCH,CAoCY,IApCZ,EAqCGC,IArCH,CAqCQjI,EAAE,CAACkI,UArCX,EAsCGlB,IAtCH,CAsCQ,mBAtCR,EAsC6B,CAtC7B;AAwCA,QAAMmB,KAAK,GAAGtG,MAAM,CACjBgF,MADW,CACJ,GADI,EAEXG,IAFW,CAEN,OAFM,EAEG,MAFH,EAGXA,IAHW,CAGN,WAHM,EAGOvB,CAAC,IAAK,aAAYA,CAAC,CAAC4B,CAAE,IAAG5B,CAAC,CAAC8B,CAAE,GAHpC,CAAd,CAzHmB,CA8HnB;;AACAvH,EAAAA,EAAE,CAACqG,MAAH,CAAU,MAAV,EACGC,SADH,CACa,eADb,EAEGpG,IAFH,CAEQkG,IAAI,CAACa,WAAL,GAAmB1E,KAAnB,CAAyB,CAAzB,CAFR,EAGG2E,KAHH,GAIGL,MAJH,CAIU,SAJV,EAKGG,IALH,CAKQ,IALR,EAKcvB,CAAC,IAAIA,CAAC,CAACvF,IAAF,CAAO8D,EAL1B,EAMGgD,IANH,CAMQ,OANR,EAMiB,OANjB,EAOGA,IAPH,CAOQ,OAPR,EAOiB,CAPjB,EAQGA,IARH,CAQQ,QARR,EAQkB,CARlB,EASGA,IATH,CASQ,qBATR,EAS+B,mBAT/B,EAUGH,MAVH,CAUU,OAVV,EAWGG,IAXH,CAWQ,kBAXR,EAW4B,UAAUvB,CAAV,EAAa;AACrC,WAAOA,CAAC,CAACvF,IAAF,CAAOkI,KAAP,GAAe3C,CAAC,CAACvF,IAAF,CAAOkI,KAAtB,GACL3C,CAAC,CAACvF,IAAF,CAAO+C,GAAP,KAAe,GAAf,GAAqBoF,OAArB,GAA+BC,SADjC;AAED,GAdH,EAeGtB,IAfH,CAeQ,QAfR,EAekB,CAflB,EAgBGA,IAhBH,CAgBQ,OAhBR,EAgBiB,CAhBjB,EAiBGA,IAjBH,CAiBQ,qBAjBR,EAiB+B,gBAjB/B,EA/HmB,CAkJnB;;AACA,QAAMuB,eAAe,GAAGJ,KAAK,CAC1BtB,MADqB,CACd,QADc,EAErBG,IAFqB,CAEhB,OAFgB,EAEP,aAFO,EAGrBA,IAHqB,CAGhB,IAHgB,EAGV,CAHU,EAIrBA,IAJqB,CAIhB,IAJgB,EAIV,CAJU,EAKrBA,IALqB,CAKhB,GALgB,EAKX,EALW,EAMrBG,KANqB,CAMf,MANe,EAMP1B,CAAC,IAAK,QAAOA,CAAC,CAACvF,IAAF,CAAO8D,EAAG,GANhB,CAAxB;AAQAmE,EAAAA,KAAK,CACFK,MADH,CACU,GADV,EACe,oBADf,EAEGxB,IAFH,CAEQ,OAFR,EAEiB,WAFjB,EAGGV,SAHH,CAGa,MAHb,EAIGpG,IAJH,CAIQuF,CAAC,IAAIA,CAAC,CAACvF,IAAF,CAAOwE,SAJpB,EAKGwC,KALH,GAKWL,MALX,CAKkB,MALlB,EAMGG,IANH,CAMQ,OANR,EAMiBvB,CAAC,IAAK,YAAWA,CAAE,EANpC,EAOGuB,IAPH,CAOQ,GAPR,EAOa,CAAC,CAPd,EAQGA,IARH,CAQQ,GARR,EAQa,CAAC,CARd,EASGG,KATH,CASS,SATT,EASoB,CATpB,EAUGH,IAVH,CAUQ,OAVR,EAUiB,EAVjB,EAWGA,IAXH,CAWQ,QAXR,EAWkB,EAXlB,EAYGG,KAZH,CAYS,MAZT,EAYiB1B,CAAC,IAAK,QAAOA,CAAE,GAZhC,EA3JmB,CAyKnB;;AACA,QAAMgD,gBAAgB,GAAGN,KAAK,CAC3BtB,MADsB,CACf,QADe,EAEtBG,IAFsB,CAEjB,OAFiB,EAER,cAFQ,EAGtBA,IAHsB,CAGjB,IAHiB,EAGX,CAHW,EAItBA,IAJsB,CAIjB,IAJiB,EAIX,CAJW,EAKtBA,IALsB,CAKjB,GALiB,EAKZ,EALY,EAMtBA,IANsB,CAMjB,SANiB,EAMN,CANM,EAOtBG,KAPsB,CAOhB,QAPgB,EAON1B,CAAC;AAAA;;AAAA,WAAI,sBAAAA,CAAC,CAACvF,IAAF,CAAOwE,SAAP,wEAAkBrC,MAAlB,IAA2B,CAA3B,GAA+B,SAA/B,GAA2C,SAA/C;AAAA,GAPK,EAQtB8E,KARsB,CAQhB,MARgB,EAQR1B,CAAC,IAAIzF,EAAE,CAAC0I,eAAH,CAAmB,CAACjD,CAAC,CAACvF,IAAF,CAAOgD,UAAP,GAAoB,CAArB,IAA0B,EAA7C,CARG,EAStBuD,EATsB,CASnB,OATmB,EASV,UAAUkC,KAAV,EAAiB;AAC5B,QAAI5E,MAAM,GAAG,KAAK6E,aAAlB;AACA,QAAIC,MAAM,GAAG9E,MAAM,CAAC+E,SAAP,CAAiBC,QAAjB,CAA0B,QAA1B,CAAb;AACA,QAAI1B,CAAJ,EAAOE,CAAP,EAAUnE,CAAV;;AAEA,QAAIyF,MAAJ,EAAY;AACV9E,MAAAA,MAAM,CAAC+E,SAAP,CAAiBvC,MAAjB,CAAwB,QAAxB;;AACAc,MAAAA,CAAC,GAAGE,CAAC,GAAIyB,CAAD,IAAO,CAAC,CAAhB;;AACA5F,MAAAA,CAAC,GAAG,CAAJ;AACD,KAJD,MAIO;AACLW,MAAAA,MAAM,CAAC+E,SAAP,CAAiBG,GAAjB,CAAqB,QAArB;;AACA5B,MAAAA,CAAC,GAAI1C,CAAD,IAAOxC,IAAI,CAAC+G,GAAL,CAAS,CAAC,CAACvE,CAAD,GAAK,CAAN,IAAW,CAAX,GAAexC,IAAI,CAACgH,EAA7B,IAAmC,EAAnC,GAAwC,CAAnD;;AACA5B,MAAAA,CAAC,GAAI5C,CAAD,IAAOxC,IAAI,CAACiH,GAAL,CAAS,CAAC,CAACzE,CAAD,GAAK,CAAN,IAAW,CAAX,GAAexC,IAAI,CAACgH,EAA7B,IAAmC,EAAnC,GAAwC,CAAnD;;AACA/F,MAAAA,CAAC,GAAG,CAAJ;AACD;;AAEDpD,IAAAA,EAAE,CAACqG,MAAH,CAAUtC,MAAV,EACGsC,MADH,CACU,aADV,EAEGC,SAFH,CAEa,eAFb,EAGGyB,UAHH,GAIGf,IAJH,CAIQ,GAJR,EAIa,CAACvB,CAAD,EAAId,CAAJ,KAAU0C,CAAC,CAAC1C,CAAD,CAJxB,EAKGqC,IALH,CAKQ,GALR,EAKa,CAACvB,CAAD,EAAId,CAAJ,KAAU4C,CAAC,CAAC5C,CAAD,CALxB,EAMGwC,KANH,CAMS,SANT,EAMoB/D,CANpB,EAOG6E,IAPH,CAOQjI,EAAE,CAACqJ,WAAH,CAAeC,SAAf,CAAyB,CAAzB,CAPR;AAQD,GAjCsB,CAAzB,CA1KmB,CA6MnB;;AACA,QAAMC,kBAAkB,GAAGpB,KAAK,CAC7BK,MADwB,CACjB,QADiB,EACP,QADO,EAExBxB,IAFwB,CAEnB,OAFmB,EAEV,gBAFU,EAGxBA,IAHwB,CAGnB,IAHmB,EAGb,CAHa,EAIxBA,IAJwB,CAInB,IAJmB,EAIb,CAJa,EAKxBA,IALwB,CAKnB,GALmB,EAKd,EALc,EAMxBG,KANwB,CAMlB,MANkB,EAMV,OANU,EAOxBA,KAPwB,CAOlB,QAPkB,EAOR,QAPQ,EAQxBA,KARwB,CAQlB,cARkB,EAQF,GARE,CAA3B;AAUArF,EAAAA,MAAM,GAAGD,MAAM,CACZgF,MADM,CACC,GADD,EAENG,IAFM,CAED,OAFC,EAEQ,OAFR,EAGNA,IAHM,CAGD,WAHC,EAGYvB,CAAC,IAAK,aAAYA,CAAC,CAAC4B,CAAE,IAAG5B,CAAC,CAAC8B,CAAF,GAAM,EAAG,GAH9C,CAAT;AAKAxF,EAAAA,WAAW,GAAGD,MAAM,CACjBqD,MADW,CACJM,CAAC,IAAIA,CAAC,CAACvF,IAAF,CAAO0D,UADR,EAEX4F,OAFW,CAEH,aAFG,EAEY,IAFZ,CAAd,CA7NmB,CAiOnB;;AACA1H,EAAAA,MAAM,CACH+E,MADH,CACU,MADV,EAEGG,IAFH,CAEQ,GAFR,EAEa,CAFb,EAGGA,IAHH,CAGQ,GAHR,EAGa,CAHb,EAIGA,IAJH,CAIQ,aAJR,EAIuB,QAJvB,EAKGH,MALH,CAKU,OALV,EAMGG,IANH,CAMQ,GANR,EAMa,CANb,EAOGA,IAPH,CAOQ,IAPR,EAOc,OAPd,EAQGyC,IARH,CAQQhE,CAAC,IAAIA,CAAC,CAACvF,IAAF,CAAO8E,KAAP,CAAalC,MAR1B,EASG+D,MATH,CASU,OATV,EAUGG,IAVH,CAUQ,GAVR,EAUa,CAVb,EAWGA,IAXH,CAWQ,IAXR,EAWc,OAXd,EAYGyC,IAZH,CAYQhE,CAAC,IAAIA,CAAC,CAACvF,IAAF,CAAO8E,KAAP,CAAajC,MAZ1B,EAlOmB,CAgPnB;;AACAhB,EAAAA,WAAW,CACR8E,MADH,CACU,MADV,EAEG2C,OAFH,CAEW,YAFX,EAEyB,IAFzB,EAGGxC,IAHH,CAGQ,GAHR,EAGa,CAHb,EAIGA,IAJH,CAIQ,GAJR,EAIa,CAJb,EAKGA,IALH,CAKQ,aALR,EAKuB,QALvB,EAMGH,MANH,CAMU,OANV,EAOGG,IAPH,CAOQ,GAPR,EAOa,CAPb,EAQGA,IARH,CAQQ,IARR,EAQc,OARd,EASGyC,IATH,CASQhE,CAAC,IAAIA,CAAC,CAACvF,IAAF,CAAO0D,UAAP,CAAkBd,MAT/B,EAUG+D,MAVH,CAUU,OAVV,EAWGG,IAXH,CAWQ,GAXR,EAWa,CAXb,EAYGA,IAZH,CAYQ,IAZR,EAYc,OAZd,EAaGyC,IAbH,CAaQhE,CAAC,IAAIA,CAAC,CAACvF,IAAF,CAAO0D,UAAP,CAAkBb,MAb/B;AAeA,QAAM2G,cAAc,GAAG7H,MAAM,CAC1BsD,MADoB,CACbM,CAAC,IAAIA,CAAC,CAACvF,IAAF,CAAO8E,KAAP,CAAanC,WADL,EAEpBgE,MAFoB,CAEb,GAFa,EAGpBG,IAHoB,CAGf,OAHe,EAGN,qBAHM,EAIpBA,IAJoB,CAIf,WAJe,EAIFvB,CAAC,IAAK,aAAYA,CAAC,CAAC4B,CAAE,IAAG5B,CAAC,CAAC8B,CAAF,GAAM,EAAG,GAJhC,EAKpBP,IALoB,CAKf,SALe,EAKJ,GALI,EAMpBP,EANoB,CAMjB,WANiB,EAMJ,YAAY;AAC3BzG,IAAAA,EAAE,CAACqG,MAAH,CAAU,IAAV,EAAgB0B,UAAhB,GACGC,QADH,CACY,GADZ,EAEGhB,IAFH,CAEQ,SAFR,EAEmB,CAFnB;AAGD,GAVoB,EAWpBP,EAXoB,CAWjB,UAXiB,EAWL,YAAY;AAC1BzG,IAAAA,EAAE,CAACqG,MAAH,CAAU,IAAV,EAAgB0B,UAAhB,GACG4B,KADH,CACS,GADT,EAEG3B,QAFH,CAEY,GAFZ,EAGGhB,IAHH,CAGQ,SAHR,EAGmB,CAHnB;AAID,GAhBoB,CAAvB;AAkBA0C,EAAAA,cAAc,CACX7C,MADH,CACU,MADV,EAEGG,IAFH,CAEQ,GAFR,EAEa,CAFb,EAGGA,IAHH,CAGQ,GAHR,EAGa,CAHb,EAIGA,IAJH,CAIQ,aAJR,EAIuB,QAJvB,EAKGH,MALH,CAKU,OALV,EAMGG,IANH,CAMQ,GANR,EAMa,CANb,EAOGA,IAPH,CAOQ,IAPR,EAOc,OAPd,EAQGyC,IARH,CAQQhE,CAAC,IAAIA,CAAC,CAACvF,IAAF,CAAO8E,KAAP,CAAa1C,KAR1B,EASGuE,MATH,CASU,OATV,EAUGG,IAVH,CAUQ,GAVR,EAUa,CAVb,EAWGA,IAXH,CAWQ,IAXR,EAWc,OAXd,EAYGyC,IAZH,CAYQhE,CAAC,IAAIA,CAAC,CAACvF,IAAF,CAAO8E,KAAP,CAAavC,KAZ1B;AAcAiH,EAAAA,cAAc,CACXlB,MADH,CACU,MADV,EACkB,MADlB,EAEGxB,IAFH,CAEQ,MAFR,EAEgB,OAFhB,EAGGA,IAHH,CAGQ,OAHR,EAGiB,YAAY;AACzB,WAAO,KAAK4C,WAAL,CAAiBC,OAAjB,GAA2BC,KAA3B,GAAmC,EAA1C;AACD,GALH,EAMG9C,IANH,CAMQ,QANR,EAMkB,YAAY;AAC1B,WAAO,KAAK4C,WAAL,CAAiBC,OAAjB,GAA2BE,MAAlC;AACD,GARH,EASG/C,IATH,CASQ,GATR,EASa,YAAY;AACrB,WAAO,KAAK4C,WAAL,CAAiBC,OAAjB,GAA2BxC,CAA3B,GAA+B,CAAtC;AACD,GAXH,EAYGL,IAZH,CAYQ,GAZR,EAYa,YAAY;AACrB,WAAO,KAAK4C,WAAL,CAAiBC,OAAjB,GAA2BtC,CAAlC;AACD,GAdH;;AAgBA,WAASR,WAAT,CAAqBiD,KAArB,EAA4B;AAC1BzB,IAAAA,eAAe,CACZpB,KADH,CACS,MADT,EACiB1B,CAAC,IAAIuE,KAAK,GAAI,QAAOvE,CAAC,CAACvF,IAAF,CAAO8D,EAAG,GAArB,GAA0B,MADrD,EAEG+D,UAFH,GAEgBC,QAFhB,CAEyB,GAFzB,EAGGhB,IAHH,CAGQ,GAHR,EAGagD,KAAK,GAAG,EAAH,GAAQ,EAH1B;AAKAvB,IAAAA,gBAAgB,CACbzB,IADH,CACQ,SADR,EACmBvB,CAAC,IAAIuE,KAAK,GAAIvE,CAAC,CAACvF,IAAF,CAAOkI,KAAP,GAAe,CAAf,GAAmB,GAAvB,GAA8B,CAD3D,EAEGL,UAFH,GAEgBC,QAFhB,CAEyB,GAFzB,EAGGhB,IAHH,CAGQ,GAHR,EAGagD,KAAK,GAAG,EAAH,GAAQ,EAH1B;AAKAT,IAAAA,kBAAkB,CACfpC,KADH,CACS,QADT,EACmB6C,KAAK,GAAGvE,CAAC,IAAIzF,EAAE,CAAC0I,eAAH,CAAmB,CAACjD,CAAC,CAACvF,IAAF,CAAOgD,UAAP,GAAoB,CAArB,IAA0B,EAA7C,CAAR,GAA2D,QADnF,EAEG6E,UAFH,GAEgBC,QAFhB,CAEyB,GAFzB,EAGGhB,IAHH,CAGQ,GAHR,EAGagD,KAAK,GAAG,EAAH,GAAQ,EAH1B;AAKAlI,IAAAA,MAAM,CACH0H,OADH,CACW,aADX,EAC0BQ,KAD1B,EAEGjC,UAFH,GAEgBC,QAFhB,CAEyB,GAFzB,EAGGhB,IAHH,CAGQ,WAHR,EAGqBvB,CAAC,IAAK,aAAYA,CAAC,CAAC4B,CAAE,IAAG5B,CAAC,CAAC8B,CAAF,IAAOyC,KAAK,GAAG,EAAH,GAAQ,EAApB,CAAwB,GAHtE;AAKAN,IAAAA,cAAc,CACXF,OADH,CACW,aADX,EAC0BQ,KAD1B,EAEGjC,UAFH,GAEgBC,QAFhB,CAEyB,GAFzB,EAGGhB,IAHH,CAGQ,WAHR,EAGqBvB,CAAC,IAAK,aAAYA,CAAC,CAAC4B,CAAE,IAAG5B,CAAC,CAAC8B,CAAF,IAAOyC,KAAK,GAAG,EAAH,GAAQ,EAApB,CAAwB,GAHtE;AAID;;AAEDjD,EAAAA,WAAW,CAAC,KAAD,CAAX,CA3UmB,CA6UnB;;AACA,QAAM;AAAE+C,IAAAA,KAAF;AAASC,IAAAA,MAAT;AAAiB1C,IAAAA,CAAjB;AAAoBE,IAAAA;AAApB,MAA0B5F,GAAG,CAACmC,IAAJ,GAAW+F,OAAX,EAAhC;AAEA,QAAMI,IAAI,GAAG,GAAb;AAAA,QACEC,IAAI,GAAG,GADT;AAAA,QAEEC,EAAE,GAAG9C,CAAC,GAAG,MAAI6C,IAFf;AAAA,QAGEE,EAAE,GAAG7C,CAAC,GAAG0C,IAHX;AAAA,QAIEI,EAAE,GAAGhD,CAAC,GAAGyC,KAAJ,GAAYI,IAJnB;AAAA,QAKEI,EAAE,GAAG/C,CAAC,GAAGwC,MAAJ,GAAaE,IALpB;AAOArI,EAAAA,IAAI,CAAC2I,eAAL,CAAqB,CAAC,CAACJ,EAAD,EAAKC,EAAL,CAAD,EAAW,CAACC,EAAD,EAAKC,EAAL,CAAX,CAArB;AACD;;AAGD,SAASE,UAAT,GAAsB;AACpB,QAAMC,IAAI,GAAGzK,EAAE,CAACqG,MAAH,CAAU,YAAV,EAAwBvC,IAAxB,GAA+B4G,qBAA/B,EAAb;AACA,QAAM;AAAErD,IAAAA,CAAF;AAAKE,IAAAA,CAAL;AAAQuC,IAAAA,KAAR;AAAeC,IAAAA;AAAf,MAA0BpI,GAAG,CAACmC,IAAJ,GAAW+F,OAAX,EAAhC;AAEA,MAAIc,OAAO,GAAG,CAACF,IAAI,CAACV,MAAL,GAAcA,MAAM,GAAGvI,aAAa,CAACsF,CAAtC,IAA2C,CAA3C,GAA+CS,CAAC,GAAG/F,aAAa,CAACsF,CAA/E;AACA,MAAI8D,OAAO,GAAG,CAACH,IAAI,CAACX,KAAL,GAAaA,KAAK,GAAGtI,aAAa,CAACsF,CAApC,IAAyC,CAAzC,GAA6CO,CAAC,GAAG7F,aAAa,CAACsF,CAA7E;AAEA9G,EAAAA,EAAE,CAACqG,MAAH,CAAU,YAAV,EAAwBO,IAAxB,CAA6BhF,IAAI,CAAC8E,SAAlC,EAA6C1G,EAAE,CAACyB,YAAH,CAAgBoJ,SAAhB,CAA0BD,OAA1B,EAAmCD,OAAnC,EAA4CjJ,KAA5C,CAAkD,GAAlD,CAA7C;AACD;;AAGD,SAASoJ,UAAT,CAAoB9F,KAApB,EAA2B7B,QAA3B,EAAqC;AACnCtB,EAAAA,MAAM,CACHmF,IADH,CACQ,SADR,EACmBvB,CAAC,IAAI;AACpB,QAAIA,CAAC,CAACvF,IAAF,CAAOgD,UAAP,GAAoBC,QAAxB,EACE,OAAO,GAAP;AACF,QAAI6B,KAAK,CAAC3C,MAAN,KAAiB,CAArB,EACE,OAAO,CAAP;AACF,QAAIoD,CAAC,CAACvF,IAAF,CAAOwE,SAAP,CAAiBqG,IAAjB,CAAsB1G,CAAC,IAAIW,KAAK,CAACgG,QAAN,CAAe3G,CAAf,CAA3B,CAAJ,EACE,OAAO,CAAP;AACF,WAAO,GAAP;AACD,GATH;AAWAtC,EAAAA,WAAW,CACRoD,MADH,CACU,UAAUM,CAAV,EAAa;AACnB,UAAMpB,CAAC,GAAGrE,EAAE,CAACqG,MAAH,CAAU,IAAV,CAAV;;AACA,QAAI1C,cAAc,CAAC8B,CAAC,CAACvF,IAAH,EAASiD,QAAT,CAAlB,EAAsC;AAAA;;AACpC,YAAM8H,SAAS,GAAGjI,iBAAiB,CAACyC,CAAC,CAACvF,IAAH,EAASiD,QAAT,CAAnC;AACAsC,MAAAA,CAAC,CAACvF,IAAF,CAAO0D,UAAP,GAAoB5B,YAAY,CAC9BiJ,SAAS,GAAG,GAAZ,qBAAkBxF,CAAC,CAACvF,IAAF,CAAO+E,KAAzB,kDAAkB,cAAe,CAAf,EAAkB1E,IAApC,CAD8B,CAAhC;AAEA8D,MAAAA,CAAC,CAACmF,OAAF,CAAU,aAAV,EAAyB,IAAzB;AACA,aAAO,IAAP;AACD;;AACDnF,IAAAA,CAAC,CAACmF,OAAF,CAAU,aAAV,EAAyB,KAAzB;AACA,WAAO,KAAP;AACD,GAZH,EAaGnD,MAbH,CAaU,iBAbV,EAcGA,MAdH,CAcU,OAdV,EAeGoD,IAfH,CAeQhE,CAAC,IAAIA,CAAC,CAACvF,IAAF,CAAO0D,UAAP,CAAkBd,MAf/B,EAgBG+D,MAhBH,CAgBU,OAhBV,EAiBGG,IAjBH,CAiBQ,GAjBR,EAiBa,CAjBb,EAkBGA,IAlBH,CAkBQ,IAlBR,EAkBc,OAlBd,EAmBGyC,IAnBH,CAmBQhE,CAAC,IAAIA,CAAC,CAACvF,IAAF,CAAO0D,UAAP,CAAkBb,MAnB/B;AAoBD;;AAID,SAASmI,YAAT,CAAsBC,cAAtB,EAAsC;AACpCpJ,EAAAA,WAAW,CACRyH,OADH,CACW,MADX,EACmB2B,cADnB;AAED;;AAGD,SAASC,SAAT,GAAqB;AAAA;;AACnB,QAAM,CAACC,QAAD,EAAWC,WAAX,IAA0BlM,QAAQ,CAAC,KAAD,CAAxC;AACA,QAAM,CAACmM,QAAD,EAAWC,WAAX,IAA0BpM,QAAQ,CAAC,KAAD,CAAxC;AACA,QAAM,CAACqM,IAAD,EAAOC,OAAP,IAAkBtM,QAAQ,CAACgC,KAAK,CAACC,IAAP,CAAhC;AACA,QAAM,CAACsK,OAAD,EAAUC,UAAV,IAAwBxM,QAAQ,CAACgB,QAAD,CAAtC;AACA,QAAM,CAACsE,SAAD,EAAYmH,YAAZ,IAA4BzM,QAAQ,CAAC,EAAD,CAA1C;AACA,QAAM,CAACiE,IAAD,EAAOyI,OAAP,IAAkB1M,QAAQ,CAACgB,QAAD,CAAhC;AACA,QAAM,CAACwD,UAAD,EAAamI,aAAb,IAA8B3M,QAAQ,CAAC,KAAD,CAA5C;;AAEA,QAAM4M,cAAc,GAAG,MAAM;AAC3BV,IAAAA,WAAW,CAAC,CAACD,QAAF,CAAX;AACD,GAFD;;AAIA,QAAMY,YAAY,GAAG,MAAM;AACzBT,IAAAA,WAAW,CAAC,CAACD,QAAF,CAAX;AACD,GAFD;;AAIA,QAAMW,UAAU,GAAG,MAAM;AACvBR,IAAAA,OAAO,CAACD,IAAI,KAAKrK,KAAK,CAACC,IAAf,GAAsBD,KAAK,CAAC+K,KAA5B,GAAoC/K,KAAK,CAACC,IAA3C,CAAP;AACD,GAFD;;AAIA,QAAM+K,eAAe,GAAG,MAAM;AAC5BlB,IAAAA,YAAY,CAAC,CAACtH,UAAF,CAAZ;AACAmI,IAAAA,aAAa,CAAC,CAACnI,UAAF,CAAb;AACD,GAHD;;AAKA,QAAMyI,eAAe,GAAI9L,IAAD,IAAU;AAChC,UAAMoE,CAAC,GAAGD,SAAS,CAACY,OAAV,CAAkB/E,IAAlB,CAAV;AAEA,QAAIoE,CAAC,KAAK,CAAC,CAAX,EACED,SAAS,CAAC4H,MAAV,CAAiB3H,CAAjB,EAAoB,CAApB,EADF,KAGED,SAAS,CAAC6H,IAAV,CAAehM,IAAf;AAEFsL,IAAAA,YAAY,CAAC,CAAC,GAAGnH,SAAJ,CAAD,CAAZ;AACD,GATD;;AAWAvF,EAAAA,SAAS,CAAC,MAAM;AACdqF,IAAAA,SAAS;AACTgG,IAAAA,UAAU;AACX,GAHQ,EAGN,EAHM,CAAT;AAKArL,EAAAA,SAAS,CAAC,MAAM;AACd2L,IAAAA,UAAU,CAACpG,SAAD,EAAYrB,IAAZ,CAAV;AACD,GAFQ,EAEN,CAACqB,SAAD,EAAYrB,IAAZ,CAFM,CAAT;AAIA,sBACE;AAAK,IAAA,EAAE,EAAC,QAAR;AAAiB,IAAA,SAAS,EAAEpD,UAAU,CAAC,oBAAD,EAAuB;AAAE,gBAAUsL;AAAZ,KAAvB,CAAtC;AAAA,4BACE;AAAK,MAAA,SAAS,EAAC,UAAf;AAAA,8BACE;AAAQ,QAAA,SAAS,EAAC,iBAAlB;AAAoC,QAAA,OAAO,EAAES,cAA7C;AAAA,+BACE;AAAA,iCACE,QAAC,eAAD;AACE,YAAA,IAAI,EAAEX,QAAQ,GAAGvL,WAAH,GAAiBC,YADjC;AAEE,YAAA,IAAI,EAAE;AAFR;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA,cADF,eAQE;AAAK,QAAA,SAAS,EAAEE,UAAU,CAAC,eAAD,EAAkB;AAAE,kBAAQ,CAACoL;AAAX,SAAlB,CAA1B;AAAA,+BACE;AAAK,UAAA,SAAS,EAAC,kBAAf;AAAA,kCACE;AAAK,YAAA,SAAS,EAAC,MAAf;AAAA,mCACE;AAAK,cAAA,SAAS,EAAC,kDAAf;AAAkE,cAAA,KAAK,EAAE;AAAEmB,gBAAAA,SAAS,EAAE;AAAb,eAAzE;AAAA,sCACE,QAAC,eAAD;AACE,gBAAA,OAAO,EAAEP,YADX;AAEE,gBAAA,SAAS,EAAC,WAFZ;AAGE,gBAAA,IAAI,EAAEV,QAAQ,GAAGjM,UAAH,GAAgBC,QAHhC;AAIE,gBAAA,IAAI,EAAC;AAJP;AAAA;AAAA;AAAA;AAAA,sBADF,eAME,QAAC,eAAD;AACE,gBAAA,KAAK,EAAE;AAAEkN,kBAAAA,MAAM,EAAE,aAAV;AAAyBC,kBAAAA,OAAO,EAAE;AAAlC,iBADT;AAEE,gBAAA,OAAO,EAAER,UAFX;AAGE,gBAAA,SAAS,EAAC,WAHZ;AAIE,gBAAA,IAAI,EAAET,IAAI,KAAKrK,KAAK,CAACC,IAAf,GAAsB5B,gBAAtB,GAAyCD,SAJjD;AAKE,gBAAA,IAAI,EAAEiM,IAAI,KAAKrK,KAAK,CAACC,IAAf,GAAsB,IAAtB,GAA6B;AALrC;AAAA;AAAA;AAAA;AAAA,sBANF;AAAA;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA,kBADF,eAgBE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBAhBF,eAiBE;AAAK,YAAA,SAAS,EAAC,qCAAf;AAAA,oCACE;AAAK,cAAA,SAAS,EAAC,MAAf;AAAA,sCACE;AAAK,gBAAA,KAAK,EAAE;AAAEsL,kBAAAA,YAAY,EAAE;AAAhB,iBAAZ;AAAA,uCACE,QAAC,eAAD;AACE,kBAAA,OAAO,EAAE,MAAMf,UAAU,CAAED,OAAD,IAAaxJ,IAAI,CAACmC,GAAL,CAAS,EAAEqH,OAAX,EAAoBxL,QAAQ,GAAG,CAA/B,CAAd,CAD3B;AAEE,kBAAA,KAAK,EAAEwL,OAAO,KAAKxL,QAAQ,GAAG,CAAvB,GAA2B;AAAEuM,oBAAAA,OAAO,EAAE;AAAX,mBAA3B,GAA8C;AAAED,oBAAAA,MAAM,EAAE;AAAV,mBAFvD;AAGE,kBAAA,IAAI,EAAE7M,SAHR;AAIE,kBAAA,IAAI,EAAC;AAJP;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA,sBADF,EASI,CAAC,GAAGgN,KAAK,CAAC,CAAD,CAAL,CAASC,IAAT,EAAJ,EAAqB3H,GAArB,CAAyBP,CAAC,IAAIgH,OAAO,GAAG,CAAV,GAAchH,CAA5C,EAA+CO,GAA/C,CAAmDP,CAAC,iBAClD;AAAa,gBAAA,SAAS,EAAE1E,UAAU,CAAC,cAAD,EAAiB;AAAE,8BAAY0E,CAAC,GAAGtB;AAAlB,iBAAjB,CAAlC;AACE,gBAAA,OAAO,EAAE,MAAMyI,OAAO,CAACnH,CAAD,CADxB;AAAA,wCAGE;AAAK,kBAAA,SAAS,EAAC,cAAf;AACE,kBAAA,KAAK,EAAE;AAAEmI,oBAAAA,eAAe,EAAE9M,EAAE,CAAC0I,eAAH,CAAmB,CAAC/D,CAAC,GAAG,CAAL,IAAU,EAA7B;AAAnB;AADT;AAAA;AAAA;AAAA;AAAA,wBAHF,EAKG,OAAOA,CALV;AAAA,iBAAUA,CAAV;AAAA;AAAA;AAAA;AAAA,sBADF,CATJ;AAAA;AAAA;AAAA;AAAA;AAAA,oBADF,eAqBE;AAAK,cAAA,SAAS,EAAC,MAAf;AAAA,yBAEI,CAAC,GAAGiI,KAAK,CAAC,CAAD,CAAL,CAASC,IAAT,EAAJ,EAAqB3H,GAArB,CAAyBP,CAAC,IAAIgH,OAAO,GAAG,CAAV,GAAchH,CAA5C,EAA+CO,GAA/C,CAAmDP,CAAC,iBAClD;AAAa,gBAAA,SAAS,EAAE1E,UAAU,CAAC,cAAD,EAAiB;AAAE,8BAAY0E,CAAC,GAAGtB;AAAlB,iBAAjB,CAAlC;AACE,gBAAA,OAAO,EAAE,MAAMyI,OAAO,CAACnH,CAAD,CADxB;AAAA,wCAGE;AAAK,kBAAA,SAAS,EAAC,cAAf;AACE,kBAAA,KAAK,EAAE;AAAEmI,oBAAAA,eAAe,EAAE9M,EAAE,CAAC0I,eAAH,CAAmB,CAAC/D,CAAC,GAAG,CAAL,IAAU,EAA7B;AAAnB;AADT;AAAA;AAAA;AAAA;AAAA,wBAHF,EAKG,OAAOA,CALV;AAAA,iBAAUA,CAAV;AAAA;AAAA;AAAA;AAAA,sBADF,CAFJ,eAYE;AAAK,gBAAA,KAAK,EAAE;AAAEgI,kBAAAA,YAAY,EAAE;AAAhB,iBAAZ;AAAA,uCACE,QAAC,eAAD;AACE,kBAAA,OAAO,EAAE,MAAMf,UAAU,CAAED,OAAD,IAAaxJ,IAAI,CAACuB,GAAL,CAAS,EAAEiI,OAAX,EAAoBvL,QAApB,CAAd,CAD3B;AAEE,kBAAA,KAAK,EAAEuL,OAAO,KAAKvL,QAAZ,GAAuB;AAAEsM,oBAAAA,OAAO,EAAE;AAAX,mBAAvB,GAA0C;AAAED,oBAAAA,MAAM,EAAE;AAAV,mBAFnD;AAGE,kBAAA,IAAI,EAAE5M,WAHR;AAIE,kBAAA,IAAI,EAAC;AAJP;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA,sBAZF;AAAA;AAAA;AAAA;AAAA;AAAA,oBArBF;AAAA;AAAA;AAAA;AAAA;AAAA,kBAjBF,eA4DE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBA5DF,eA6DE;AAAK,YAAA,SAAS,EAAC,cAAf;AAAA,sBAEIkN,MAAM,CAACC,OAAP,CAAe3M,aAAf,EAA8B6E,GAA9B,CAAkC,CAAC,CAAC+H,GAAD,EAAMC,GAAN,CAAD,kBAChC;AAAe,cAAA,SAAS,EAAEjN,UAAU,CAAC,UAAD,EAAa;AAAE,4BAAYyE,SAAS,CAACrC,MAAV,KAAqB,CAArB,IAA0B,CAACqC,SAAS,CAACsG,QAAV,CAAmBiC,GAAnB;AAAzC,eAAb,CAApC;AACE,cAAA,OAAO,EAAE,MAAMZ,eAAe,CAACY,GAAD,CADhC;AAAA,sCAEE;AAAK,gBAAA,GAAG,EAAEC,GAAG,CAAC1M;AAAd;AAAA;AAAA;AAAA;AAAA,sBAFF,eAGE;AAAA,0BAAM0M,GAAG,CAAC3M;AAAV;AAAA;AAAA;AAAA;AAAA,sBAHF;AAAA,eAAU0M,GAAV;AAAA;AAAA;AAAA;AAAA,oBADF;AAFJ;AAAA;AAAA;AAAA;AAAA,kBA7DF,eAwEE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBAxEF,eAyEE;AAAK,YAAA,SAAS,EAAC,MAAf;AAAA,oCACE;AAAK,cAAA,SAAS,EAAC,MAAf;AACE,cAAA,KAAK,EAAE;AAAEE,gBAAAA,UAAU,EAAE,GAAd;AAAmBT,gBAAAA,OAAO,EAAE,GAA5B;AAAiCU,gBAAAA,cAAc,EAAE,cAAjD;AAAiEX,gBAAAA,MAAM,EAAE;AAAzE,eADT;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBADF,eAME;AAAK,cAAA,SAAS,EAAC,MAAf;AACE,cAAA,KAAK,EAAE;AAAEU,gBAAAA,UAAU,EAAEvJ,UAAU,GAAG,GAAH,GAAS,GAAjC;AAAsC8I,gBAAAA,OAAO,EAAE9I,UAAU,GAAG,CAAH,GAAO,GAAhE;AAAqE6I,gBAAAA,MAAM,EAAE;AAA7E,eADT;AAEE,cAAA,OAAO,EAAEL,eAFX;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBANF;AAAA;AAAA;AAAA;AAAA;AAAA,kBAzEF;AAAA;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA,cARF;AAAA;AAAA;AAAA;AAAA;AAAA,YADF,eAmGE;AAAK,MAAA,SAAS,EAAC,QAAf;AAAA,6BACE;AAAA,gCACE;AAAQ,UAAA,EAAE,EAAC,KAAX;AAAiB,UAAA,OAAO,EAAC,WAAzB;AAAqC,UAAA,IAAI,EAAC,IAA1C;AAA+C,UAAA,IAAI,EAAC,IAApD;AAAyD,UAAA,WAAW,EAAC,IAArE;AAA0E,UAAA,YAAY,EAAC,IAAvF;AAAA,iCACE;AAAQ,YAAA,EAAE,EAAC,IAAX;AAAgB,YAAA,EAAE,EAAC,IAAnB;AAAwB,YAAA,CAAC,EAAC,GAA1B;AAA8B,YAAA,IAAI,EAAC;AAAnC;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA,gBADF,eAIE;AAAQ,UAAA,EAAE,EAAC,cAAX;AAA0B,UAAA,MAAM,EAAC,MAAjC;AAAA,kCACE;AAAgB,YAAA,EAAE,EAAC,aAAnB;AAAiC,YAAA,YAAY,EAAC,GAA9C;AAAkD,YAAA,MAAM,EAAC;AAAzD;AAAA;AAAA;AAAA;AAAA,kBADF,eAEE;AAAU,YAAA,EAAE,EAAC,MAAb;AAAoB,YAAA,EAAE,EAAC,GAAvB;AAA2B,YAAA,EAAE,EAAC,GAA9B;AAAkC,YAAA,MAAM,EAAC;AAAzC;AAAA;AAAA;AAAA;AAAA,kBAFF,eAGE;AAAA,oCACE;AAAa,cAAA,EAAE,EAAC;AAAhB;AAAA;AAAA;AAAA;AAAA,oBADF,eAEE;AAAa,cAAA,EAAE,EAAC;AAAhB;AAAA;AAAA;AAAA;AAAA,oBAFF;AAAA;AAAA;AAAA;AAAA;AAAA,kBAHF;AAAA;AAAA;AAAA;AAAA;AAAA,gBAJF,eAYE;AAAQ,UAAA,EAAE,EAAC,aAAX;AAAyB,UAAA,WAAW,EAAC,gBAArC;AAAsD,UAAA,KAAK,EAAC,MAA5D;AAAmE,UAAA,MAAM,EAAC,MAA1E;AAAA,kCACE;AAAgB,YAAA,EAAE,EAAC,eAAnB;AAAmC,YAAA,YAAY,EAAC,GAAhD;AAAoD,YAAA,MAAM,EAAC;AAA3D;AAAA;AAAA;AAAA;AAAA,kBADF,eAGE;AAAU,YAAA,EAAE,EAAC,WAAb;AAAyB,YAAA,EAAE,EAAC,GAA5B;AAAgC,YAAA,EAAE,EAAC,GAAnC;AAAuC,YAAA,MAAM,EAAC;AAA9C;AAAA;AAAA;AAAA;AAAA,kBAHF,eAIE;AAAU,YAAA,EAAE,EAAC,WAAb;AAAyB,YAAA,EAAE,EAAC,IAA5B;AAAiC,YAAA,EAAE,EAAC,IAApC;AAAyC,YAAA,MAAM,EAAC;AAAhD;AAAA;AAAA;AAAA;AAAA,kBAJF,eAKE;AAAS,YAAA,EAAE,EAAC,eAAZ;AAA4B,YAAA,GAAG,EAAC,YAAhC;AAA6C,YAAA,IAAI,EAAC;AAAlD;AAAA;AAAA;AAAA;AAAA,kBALF;AAAA;AAAA;AAAA;AAAA;AAAA,gBAZF,eAmBE;AAAS,UAAA,EAAE,EAAC,cAAZ;AAA2B,UAAA,KAAK,EAAC,GAAjC;AAAqC,UAAA,MAAM,EAAC,GAA5C;AAAgD,UAAA,mBAAmB,EAAC,mBAApE;AAAA,iCACE;AAAO,YAAA,SAAS,EAAE/D,OAAlB;AAA2B,YAAA,MAAM,EAAC,GAAlC;AAAsC,YAAA,KAAK,EAAC,GAA5C;AAAgD,YAAA,mBAAmB,EAAC;AAApE;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA,gBAnBF,eAsBE;AAAS,UAAA,EAAE,EAAC,gBAAZ;AAA6B,UAAA,KAAK,EAAC,GAAnC;AAAuC,UAAA,MAAM,EAAC,GAA9C;AAAkD,UAAA,mBAAmB,EAAC,mBAAtE;AAAA,iCACE;AAAO,YAAA,SAAS,EAAEC,SAAlB;AAA6B,YAAA,MAAM,EAAC,GAApC;AAAwC,YAAA,KAAK,EAAC,GAA9C;AAAkD,YAAA,mBAAmB,EAAC;AAAtE;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA,gBAtBF,eAyBE;AAAS,UAAA,EAAE,EAAC,KAAZ;AAAkB,UAAA,KAAK,EAAC,GAAxB;AAA4B,UAAA,MAAM,EAAC,GAAnC;AAAuC,UAAA,mBAAmB,EAAC,mBAA3D;AAAA,iCACE;AAAO,YAAA,SAAS,EAAEhI,GAAlB;AAAuB,YAAA,MAAM,EAAC,GAA9B;AAAkC,YAAA,KAAK,EAAC,GAAxC;AAA4C,YAAA,mBAAmB,EAAC;AAAhE;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA,gBAzBF,eA4BE;AAAS,UAAA,EAAE,EAAC,QAAZ;AAAqB,UAAA,KAAK,EAAC,GAA3B;AAA+B,UAAA,MAAM,EAAC,GAAtC;AAA0C,UAAA,mBAAmB,EAAC,mBAA9D;AAAA,iCACE;AAAO,YAAA,SAAS,EAAEG,MAAlB;AAA0B,YAAA,MAAM,EAAC,GAAjC;AAAqC,YAAA,KAAK,EAAC,GAA3C;AAA+C,YAAA,mBAAmB,EAAC;AAAnE;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA,gBA5BF,eA+BE;AAAS,UAAA,EAAE,EAAC,IAAZ;AAAiB,UAAA,KAAK,EAAC,GAAvB;AAA2B,UAAA,MAAM,EAAC,GAAlC;AAAsC,UAAA,mBAAmB,EAAC,mBAA1D;AAAA,iCACE;AAAO,YAAA,SAAS,EAAEE,KAAlB;AAAyB,YAAA,MAAM,EAAC,GAAhC;AAAoC,YAAA,KAAK,EAAC,GAA1C;AAA8C,YAAA,mBAAmB,EAAC;AAAlE;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA,gBA/BF,eAkCE;AAAS,UAAA,EAAE,EAAC,IAAZ;AAAiB,UAAA,KAAK,EAAC,GAAvB;AAA2B,UAAA,MAAM,EAAC,GAAlC;AAAsC,UAAA,mBAAmB,EAAC,mBAA1D;AAAA,iCACE;AAAO,YAAA,SAAS,EAAEE,GAAlB;AAAuB,YAAA,MAAM,EAAC,GAA9B;AAAkC,YAAA,KAAK,EAAC,GAAxC;AAA4C,YAAA,mBAAmB,EAAC;AAAhE;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA,gBAlCF,eAqCE;AAAS,UAAA,EAAE,EAAC,UAAZ;AAAuB,UAAA,KAAK,EAAC,GAA7B;AAAiC,UAAA,MAAM,EAAC,GAAxC;AAA4C,UAAA,mBAAmB,EAAC,mBAAhE;AAAA,iCACE;AAAO,YAAA,SAAS,EAAEE,GAAlB;AAAuB,YAAA,MAAM,EAAC,GAA9B;AAAkC,YAAA,KAAK,EAAC,GAAxC;AAA4C,YAAA,mBAAmB,EAAC;AAAhE;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA,gBArCF,eAwCE;AAAS,UAAA,EAAE,EAAC,UAAZ;AAAuB,UAAA,KAAK,EAAC,GAA7B;AAAiC,UAAA,MAAM,EAAC,GAAxC;AAA4C,UAAA,mBAAmB,EAAC,mBAAhE;AAAA,iCACE;AAAO,YAAA,SAAS,EAAEE,KAAlB;AAAyB,YAAA,MAAM,EAAC,GAAhC;AAAoC,YAAA,KAAK,EAAC,GAA1C;AAA8C,YAAA,mBAAmB,EAAC;AAAlE;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA,gBAxCF,eA2CE;AAAS,UAAA,EAAE,EAAC,SAAZ;AAAsB,UAAA,KAAK,EAAC,GAA5B;AAAgC,UAAA,MAAM,EAAC,GAAvC;AAA2C,UAAA,mBAAmB,EAAC,mBAA/D;AAAA,iCACE;AAAO,YAAA,SAAS,EAAEE,EAAlB;AAAsB,YAAA,MAAM,EAAC,GAA7B;AAAiC,YAAA,KAAK,EAAC,GAAvC;AAA2C,YAAA,mBAAmB,EAAC;AAA/D;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA,gBA3CF;AAAA;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA,YAnGF;AAAA;AAAA;AAAA;AAAA;AAAA,UADF;AAuJD;;GArMQiK,S;;KAAAA,S;AAuMT,eAAeA,SAAf","sourcesContent":["// example from https://bl.ocks.org/mbostock/3885705\n\nimport React, { useEffect, useState } from 'react';\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\nimport {\n  faCompress, faExpand,\n  faSitemap, faGripHorizontal,\n  faChevronDown, faChevronUp,\n  faArrowUp, faArrowDown,\n  faAngleLeft, faAngleRight\n} from \"@fortawesome/free-solid-svg-icons\";\n\nimport * as d3 from 'd3';\nimport classNames from \"classname\";\n\nimport data from \"Assets/db.json\";\nimport femalePic from \"Assets/default_profile/female.svg\";\nimport malePic from \"Assets/default_profile/male.svg\";\nimport nei from \"Assets/icons/nei.svg\";\nimport aettua from \"Assets/icons/aettua.svg\";\nimport anzol from \"Assets/icons/anzol.svg\";\nimport sal from \"Assets/icons/sal.svg\";\nimport rol from \"Assets/icons/rol.svg\";\nimport lenco from \"Assets/icons/lenco.svg\";\nimport pa from \"Assets/icons/pa.svg\";\n\nimport './index.css';\n\n\nconst MIN_YEAR = 10, MAX_YEAR = 21;\n\nconst organizations = {\n  nei: {\n    name: \"NEI\",\n    insignia: nei,\n  },\n  aettua: {\n    name: \"AETTUA\",\n    insignia: aettua,\n  },\n  cf: {\n    name: \"Comissão de Faina\",\n    insignia: anzol,\n  },\n  cs: {\n    name: \"Conselho do Salgado\",\n    insignia: sal,\n  },\n  escrivao: {\n    name: \"Mestre Escrivão\",\n    insignia: rol,\n  },\n  pescador: {\n    name: \"Mestre Pescador\",\n    insignia: lenco,\n  },\n  salgado: {\n    name: \"Mestre do Salgado\",\n    insignia: pa,\n  },\n}\n\nconst Modes = {\n  TREE: 1,\n  YEAR: 2\n}\n\n\n// threshold to show photos\nconst zoomThreshold = 1;\nlet lastTransform = d3.zoomIdentity.scale(0.5);\nlet svg, zoom, groups, labels, fainaLabels;\n\n\nfunction separateName(name) {\n  const maxChars = 15,\n    middleIndex = Math.ceil(name.length / 2);\n\n  let name1 = name.slice(0, middleIndex).split(\" \"),\n    name2 = name.slice(middleIndex).split(\" \"),\n    nameMid = name1.slice(-1)[0] + name2.slice(0, 1)[0];\n\n  name1 = name1.slice(0, -1).join(\" \");\n  name2 = name2.slice(1).join(\" \");\n\n  if (name1.length >= name2.length) {\n    name2 = (nameMid + \" \" + name2).trim();\n  } else {\n    name1 = (name1 + \" \" + nameMid).trim();\n  }\n\n  let isTruncated = false,\n    tname1 = name1,\n    tname2 = name2;\n\n  if (name1.length > maxChars) {\n    isTruncated = true;\n    tname1 = name1.slice(0, maxChars - 3) + \"...\";\n  }\n  if (name2.length > maxChars) {\n    isTruncated = true;\n    tname2 = name2.slice(0, maxChars - 3) + \"...\";\n  }\n\n  return { name1, name2, isTruncated, tname1, tname2 };\n}\n\n\nfunction getFainaHierarchy({ sex, start_year, organizations }, end_year) {\n  for (const o of organizations) {\n    if (o.name === \"cf\" && o.year === end_year && o.role) return o.role;\n    if (o.name === \"st\" && o.year === end_year) return o.role;\n  }\n\n  const maleHierarchies = [\"Junco\", \"Moço\", \"Marnoto\", \"Mestre\"];\n  const femaleHierarchies = [\"Caniça\", \"Moça\", \"Salineira\", \"Mestre\"];\n\n  const index = Math.min(end_year - start_year - 1, 3);\n  return (sex === \"M\") ? maleHierarchies[index] : femaleHierarchies[index];\n}\n\n\nfunction showLabelFaina({ fainaNames, start_year }, end_year) {\n  if (fainaNames && start_year + 1 <= end_year) {\n    return true;\n  }\n  return false;\n}\n\n\nfunction labelFamilies(node) {\n  if (node.parent) {\n    if (node.parent.id === \"000\") {\n      node.family = node.id;      // head of the family\n    } else {\n      node.family = node.parent.family;\n    }\n  }\n\n  if (node.children) {\n    node.family_depth = 0;\n    node.family_count = 0;\n    for (const n of node.children) {\n      labelFamilies(n);\n      node.family_depth = Math.max(node.family_depth, n.family_depth);\n      node.family_count += n.family_count;\n    }\n  } else {\n    node.family_depth = node.depth;\n    node.family_count = 1;\n  }\n}\n\n\nfunction buildTree() {\n  const assignInsignias = () => {\n    const insignias = [\"nei\", \"aettua\"];\n    const i = Math.floor(Math.random() * insignias.length * 2);\n    return insignias.slice(i);\n  }\n\n  for (const elem of data.users) {\n    elem.names = separateName(elem.name);\n    if (elem.faina) {\n      elem.fainaNames = separateName(\n        getFainaHierarchy(elem, MAX_YEAR) + \" \" + elem.faina?.[0].name);\n    }\n    elem.insignias = elem.organizations?.map(o => {\n      if (o.name !== \"st\")\n        return o.name;\n      return {\n        \"Mestre Escrivão\": \"escrivao\",\n        \"Mestre Pescador\": \"pescador\",\n        \"Mestre do Salgado\": \"salgado\"\n      }[o.role];\n    }).filter((v, i, a) => a.indexOf(v) === i) || [];\n  }\n\n  const dataStructure = d3.stratify()\n    .id(d => d.id)\n    .parentId(d => d.parent)\n    (data.users);\n\n  // label all nodes with their family id and depth\n  labelFamilies(dataStructure);\n\n  // sort head families according to the family depth\n  // sort like a normal distribution\n  dataStructure.children = dataStructure.children.slice()\n    .sort((a, b) => a.family_depth - b.family_depth || a.family_count - b.family_count)\n    .reduceRight((acc, val, i) => {\n      return i % 2 === 0 ? [...acc, val] : [val, ...acc];\n    }, []);\n\n  const treeStructure = d3.tree()\n    // .size(view)\n    .nodeSize([100, 150])\n    .separation(function (a, b) {\n      return a.family != b.family ? 4 : a.parent != b.parent ? 1.25 : 1;\n    });\n\n  const root = treeStructure(dataStructure);\n\n  // clean svg\n  d3.select(\"svg.treeei\")\n    .selectAll(\"*:not(defs, defs *)\")\n    .remove();\n\n  zoom = d3.zoom()\n    .scaleExtent([0.2, 2])\n    .on(\"zoom\", ({ transform }) => zoomed(transform));\n\n  svg = d3.select(\"svg.treeei\")\n    .call(zoom)\n    .append(\"g\")\n\n  function zoomed(transform) {\n    const n = transform.k > zoomThreshold;\n    const o = lastTransform.k > zoomThreshold;\n    if (n !== o) {\n      updateNodes(n);\n    }\n    svg.attr(\"transform\", transform);\n    lastTransform = transform;\n  }\n\n  groups = svg\n    .append(\"g\")\n    .attr(\"class\", \"nodes\")\n    .selectAll(\"g\")\n    .data(root.descendants().slice(1))\n    .enter()\n    .append(\"g\");\n\n  // links\n  groups\n    .filter(d => d.parent != root)\n    .append(\"path\")\n    .style(\"stroke\", \"silver\")\n    .attr('marker-start', 'url(#dot)')\n    .attr(\"d\", function (d) {\n      const sx = d.parent.x,\n        sy = d.parent.y + 68,\n        tx = d.x,\n        ty = d.y,\n        hy = 0.5 * (ty - sy),\n        off = 5;\n\n      let dir = sx - tx > 0 ? -1 : sx - tx < 0 ? 1 : 0;\n\n      const p = (\"M\" + sx + \",\" + (sy)\n        + \"v\" + (hy - off - 10)\n        + \"c\" + 0 + \",\" + off\n        + \" \" + 0 + \",\" + off\n        + \" \" + (off * dir) + \",\" + off\n        + \"h\" + (tx - sx - 3 * off * dir)\n        + \"c\" + (2 * off * dir) + \",\" + 0\n        + \" \" + (2 * off * dir) + \",\" + 0\n        + \" \" + (2 * off * dir) + \",\" + 2 * off\n        + \"L\" + tx + \",\" + ty\n      );\n      return p;\n    })\n    .attr(\"stroke-dasharray\", function () {\n      let length = d3.select(this).node().getTotalLength();\n      return length + \" \" + length;\n    })\n    .attr(\"stroke-dashoffset\", function () {\n      return d3.select(this).node().getTotalLength();\n    })\n    .transition()\n    .duration(3000)\n    .ease(d3.easeLinear)\n    .attr(\"stroke-dashoffset\", 0);\n\n  const nodes = groups\n    .append(\"g\")\n    .attr(\"class\", \"node\")\n    .attr(\"transform\", d => `translate(${d.x},${d.y})`);\n\n  // node images\n  d3.select(\"defs\")\n    .selectAll(\"pattern.image\")\n    .data(root.descendants().slice(1))\n    .enter()\n    .append(\"pattern\")\n    .attr(\"id\", d => d.data.id)\n    .attr(\"class\", \"image\")\n    .attr('width', 1)\n    .attr('height', 1)\n    .attr('patternContentUnits', 'objectBoundingBox')\n    .append(\"image\")\n    .attr(\"xlink:xlink:href\", function (d) {\n      return d.data.image ? d.data.image :\n        d.data.sex === \"M\" ? malePic : femalePic;\n    })\n    .attr(\"height\", 1)\n    .attr(\"width\", 1)\n    .attr(\"preserveAspectRatio\", \"xMinYMin slice\");\n\n  // circle with the person image\n  const nodesProfilePic = nodes\n    .append(\"circle\")\n    .attr(\"class\", \"profile-pic\")\n    .attr(\"cx\", 0)\n    .attr(\"cy\", 0)\n    .attr(\"r\", 10)\n    .style(\"fill\", d => `url(#${d.data.id})`);\n\n  nodes\n    .insert(\"g\", \"circle.profile-pic\")\n    .attr(\"class\", \"insignias\")\n    .selectAll(\"rect\")\n    .data(d => d.data.insignias)\n    .enter().append(\"rect\")\n    .attr(\"class\", d => `insignia ${d}`)\n    .attr(\"x\", -5)\n    .attr(\"y\", -5)\n    .style(\"opacity\", 0)\n    .attr(\"width\", 10)\n    .attr(\"height\", 10)\n    .style(\"fill\", d => `url(#${d})`);\n\n  // circle with the gradient year color\n  const nodesProfileGrad = nodes\n    .append(\"circle\")\n    .attr(\"class\", \"profile-grad\")\n    .attr(\"cx\", 0)\n    .attr(\"cy\", 0)\n    .attr(\"r\", 10)\n    .attr(\"opacity\", 1)\n    .style(\"cursor\", d => d.data.insignias?.length > 0 ? \"pointer\" : \"default\")\n    .style(\"fill\", d => d3.schemeTableau10[(d.data.start_year + 6) % 10])\n    .on(\"click\", function (event) {\n      let parent = this.parentElement;\n      let active = parent.classList.contains(\"active\");\n      let x, y, o;\n\n      if (active) {\n        parent.classList.remove(\"active\");\n        x = y = (_) => -5;\n        o = 0;\n      } else {\n        parent.classList.add(\"active\");\n        x = (i) => Math.cos((-i + 1) / 5 * Math.PI) * 30 - 5;\n        y = (i) => Math.sin((-i + 1) / 5 * Math.PI) * 30 - 5;\n        o = 1;\n      }\n\n      d3.select(parent)\n        .select(\"g.insignias\")\n        .selectAll(\"rect.insignia\")\n        .transition()\n        .attr(\"x\", (d, i) => x(i))\n        .attr(\"y\", (d, i) => y(i))\n        .style(\"opacity\", o)\n        .ease(d3.easeBackOut.overshoot(2))\n    })\n\n  // border with the year color \n  const nodesProfileBorder = nodes\n    .insert(\"circle\", \"circle\")\n    .attr(\"class\", \"profile-border\")\n    .attr(\"cx\", 0)\n    .attr(\"cy\", 0)\n    .attr(\"r\", 12)\n    .style(\"fill\", \"white\")\n    .style(\"stroke\", \"silver\")\n    .style(\"stroke-width\", 1.5)\n\n  labels = groups\n    .append(\"g\")\n    .attr(\"class\", \"label\")\n    .attr(\"transform\", d => `translate(${d.x},${d.y + 18})`);\n\n  fainaLabels = labels\n    .filter(d => d.data.fainaNames)\n    .classed(\"label-faina\", true)\n\n  // nodes' names\n  labels\n    .append(\"text\")\n    .attr(\"x\", 0)\n    .attr(\"y\", 0)\n    .attr(\"text-anchor\", \"middle\")\n    .append(\"tspan\")\n    .attr('x', 0)\n    .attr('dy', '1.2em')\n    .text(d => d.data.names.tname1)\n    .append(\"tspan\")\n    .attr('x', 0)\n    .attr('dy', '1.2em')\n    .text(d => d.data.names.tname2);\n\n  // nodes' faina names\n  fainaLabels\n    .append(\"text\")\n    .classed(\"text-faina\", true)\n    .attr(\"x\", 0)\n    .attr(\"y\", 0)\n    .attr(\"text-anchor\", \"middle\")\n    .append(\"tspan\")\n    .attr('x', 0)\n    .attr('dy', '1.2em')\n    .text(d => d.data.fainaNames.tname1)\n    .append(\"tspan\")\n    .attr('x', 0)\n    .attr('dy', '1.2em')\n    .text(d => d.data.fainaNames.tname2);\n\n  const labelsTooltips = groups\n    .filter(d => d.data.names.isTruncated)\n    .append(\"g\")\n    .attr(\"class\", \"label label-tooltip\")\n    .attr(\"transform\", d => `translate(${d.x},${d.y + 18})`)\n    .attr(\"opacity\", \"0\")\n    .on('mouseover', function () {\n      d3.select(this).transition()\n        .duration(200)\n        .attr('opacity', 1);\n    })\n    .on('mouseout', function () {\n      d3.select(this).transition()\n        .delay(200)\n        .duration(400)\n        .attr('opacity', 0);\n    });\n\n  labelsTooltips\n    .append(\"text\")\n    .attr(\"x\", 0)\n    .attr(\"y\", 0)\n    .attr(\"text-anchor\", \"middle\")\n    .append(\"tspan\")\n    .attr('x', 0)\n    .attr('dy', '1.2em')\n    .text(d => d.data.names.name1)\n    .append(\"tspan\")\n    .attr('x', 0)\n    .attr('dy', '1.2em')\n    .text(d => d.data.names.name2);\n\n  labelsTooltips\n    .insert(\"rect\", \"text\")\n    .attr(\"fill\", \"white\")\n    .attr(\"width\", function () {\n      return this.nextSibling.getBBox().width + 10;\n    })\n    .attr(\"height\", function () {\n      return this.nextSibling.getBBox().height;\n    })\n    .attr(\"x\", function () {\n      return this.nextSibling.getBBox().x - 5;\n    })\n    .attr(\"y\", function () {\n      return this.nextSibling.getBBox().y;\n    });\n\n  function updateNodes(close) {\n    nodesProfilePic\n      .style(\"fill\", d => close ? `url(#${d.data.id})` : \"none\")\n      .transition().duration(300)\n      .attr(\"r\", close ? 18 : 10);\n\n    nodesProfileGrad\n      .attr(\"opacity\", d => close ? (d.data.image ? 0 : 0.3) : 1)\n      .transition().duration(300)\n      .attr(\"r\", close ? 18 : 10);\n\n    nodesProfileBorder\n      .style(\"stroke\", close ? d => d3.schemeTableau10[(d.data.start_year + 6) % 10] : \"silver\")\n      .transition().duration(300)\n      .attr(\"r\", close ? 20 : 12);\n\n    labels\n      .classed('label-small', close)\n      .transition().duration(300)\n      .attr(\"transform\", d => `translate(${d.x},${d.y + (close ? 26 : 18)})`);\n\n    labelsTooltips\n      .classed('label-small', close)\n      .transition().duration(300)\n      .attr(\"transform\", d => `translate(${d.x},${d.y + (close ? 26 : 18)})`);\n  }\n\n  updateNodes(false);\n\n  // constrain tree\n  const { width, height, x, y } = svg.node().getBBox();\n\n  const padY = 256,\n    padX = 768,\n    x0 = x - 1.5*padX,\n    y0 = y - padY,\n    x1 = x + width + padX,\n    y1 = y + height + padY;\n\n  zoom.translateExtent([[x0, y0], [x1, y1]]);\n}\n\n\nfunction centerTree() {\n  const rect = d3.select(\"svg.treeei\").node().getBoundingClientRect();\n  const { x, y, width, height } = svg.node().getBBox();\n\n  let offsetY = (rect.height - height * lastTransform.k) / 2 - y * lastTransform.k;\n  let offsetX = (rect.width - width * lastTransform.k) / 2 - x * lastTransform.k;\n\n  d3.select(\"svg.treeei\").call(zoom.transform, d3.zoomIdentity.translate(offsetX, offsetY).scale(0.5));\n}\n\n\nfunction filterTree(names, end_year) {\n  groups\n    .attr(\"opacity\", d => {\n      if (d.data.start_year > end_year)\n        return 0.2;\n      if (names.length === 0)\n        return 1;\n      if (d.data.insignias.some(n => names.includes(n)))\n        return 1;\n      return 0.2;\n    });\n\n  fainaLabels\n    .filter(function (d) {\n      const n = d3.select(this);\n      if (showLabelFaina(d.data, end_year)) {\n        const hierarchy = getFainaHierarchy(d.data, end_year);\n        d.data.fainaNames = separateName(\n          hierarchy + \" \" + d.data.faina?.[0].name)\n        n.classed(\"label-faina\", true);\n        return true;\n      }\n      n.classed(\"label-faina\", false);\n      return false;\n    })\n    .select('text.text-faina')\n    .select(\"tspan\")\n    .text(d => d.data.fainaNames.tname1)\n    .append(\"tspan\")\n    .attr('x', 0)\n    .attr('dy', '1.2em')\n    .text(d => d.data.fainaNames.tname2);\n}\n\n\n\nfunction changeLabels(showFainaNames) {\n  fainaLabels\n    .classed(\"show\", showFainaNames);\n}\n\n\nfunction FainaTree() {\n  const [showInfo, setShowInfo] = useState(false);\n  const [expanded, setExpanded] = useState(false);\n  const [mode, setMode] = useState(Modes.TREE);\n  const [endYear, setEndYear] = useState(MAX_YEAR);\n  const [insignias, setInsignias] = useState([]);\n  const [year, setYear] = useState(MAX_YEAR);\n  const [fainaNames, setFainaNames] = useState(false);\n\n  const toggleShowInfo = () => {\n    setShowInfo(!showInfo);\n  }\n\n  const toggleExpand = () => {\n    setExpanded(!expanded);\n  }\n\n  const toggleMode = () => {\n    setMode(mode === Modes.TREE ? Modes.FAINA : Modes.TREE);\n  }\n\n  const toggeFainaNames = () => {\n    changeLabels(!fainaNames);\n    setFainaNames(!fainaNames);\n  }\n\n  const toggleInsignias = (name) => {\n    const i = insignias.indexOf(name);\n\n    if (i !== -1)\n      insignias.splice(i, 1);\n    else\n      insignias.push(name);\n\n    setInsignias([...insignias]);\n  }\n\n  useEffect(() => {\n    buildTree();\n    centerTree();\n  }, [])\n\n  useEffect(() => {\n    filterTree(insignias, year);\n  }, [insignias, year])\n\n  return (\n    <div id=\"treeei\" className={classNames(\"d-flex flex-grow-1\", { \"expand\": expanded })}>\n      <div className='side-bar'>\n        <button className='side-bar-button' onClick={toggleShowInfo}>\n          <span>\n            <FontAwesomeIcon\n              icon={showInfo ? faAngleLeft : faAngleRight}\n              size={\"sm\"} />\n          </span>\n        </button>\n        <div className={classNames(\"side-bar-body\", { \"hide\": !showInfo })}>\n          <div className='side-bar-content'>\n            <div className='mb-3'>\n              <div className=\"d-flex align-items-center justify-content-around\" style={{ minHeight: 32 }}>\n                <FontAwesomeIcon\n                  onClick={toggleExpand}\n                  className=\"menu-icon\"\n                  icon={expanded ? faCompress : faExpand}\n                  size=\"lg\" />\n                <FontAwesomeIcon\n                  style={{ cursor: \"not-allowed\", opacity: 0.25 }}\n                  onClick={toggleMode}\n                  className=\"menu-icon\"\n                  icon={mode === Modes.TREE ? faGripHorizontal : faSitemap}\n                  size={mode === Modes.TREE ? \"2x\" : \"lg\"} />\n              </div>\n            </div>\n            <h4>Matrículas</h4>\n            <div className='d-flex justify-content-between my-3'>\n              <div className='mr-3'>\n                <div style={{ marginBottom: \"0.2em\" }}>\n                  <FontAwesomeIcon\n                    onClick={() => setEndYear((endYear) => Math.max(--endYear, MIN_YEAR + 9))}\n                    style={endYear === MIN_YEAR + 9 ? { opacity: 0.5 } : { cursor: \"pointer\" }}\n                    icon={faArrowUp}\n                    size=\"sm\" />\n                </div>\n                {\n                  [...Array(5).keys()].map(i => endYear - 9 + i).map(i => (\n                    <div key={i} className={classNames(\"color-legend\", { \"inactive\": i > year })}\n                      onClick={() => setYear(i)}\n                    >\n                      <div className=\"color-bullet\"\n                        style={{ backgroundColor: d3.schemeTableau10[(i + 6) % 10] }}></div>\n                      {2000 + i}\n                    </div>\n                  ))\n                }\n              </div>\n              <div className='mr-3'>\n                {\n                  [...Array(5).keys()].map(i => endYear - 4 + i).map(i => (\n                    <div key={i} className={classNames(\"color-legend\", { \"inactive\": i > year })}\n                      onClick={() => setYear(i)}\n                    >\n                      <div className=\"color-bullet\"\n                        style={{ backgroundColor: d3.schemeTableau10[(i + 6) % 10] }}></div>\n                      {2000 + i}\n                    </div>\n                  ))\n                }\n                <div style={{ marginBottom: \"0.2em\" }}>\n                  <FontAwesomeIcon\n                    onClick={() => setEndYear((endYear) => Math.min(++endYear, MAX_YEAR))}\n                    style={endYear === MAX_YEAR ? { opacity: 0.5 } : { cursor: \"pointer\" }}\n                    icon={faArrowDown}\n                    size=\"sm\" />\n                </div>\n              </div>\n\n            </div>\n            <h4>Insígnias</h4>\n            <div className=\"mr-auto mt-3\">\n              {\n                Object.entries(organizations).map(([key, org]) => (\n                  <div key={key} className={classNames(\"insignia\", { \"inactive\": insignias.length !== 0 && !insignias.includes(key) })}\n                    onClick={() => toggleInsignias(key)}>\n                    <img src={org.insignia} />\n                    <div>{org.name}</div>\n                  </div>\n                ))\n              }\n            </div>\n            <h4>Nomes</h4>\n            <div className=\"mt-3\">\n              <div className=\"mb-2\"\n                style={{ fontWeight: 300, opacity: 0.7, textDecoration: \"line-through\", cursor: \"default\" }}\n              >\n                Mostrar apelidos\n              </div>\n              <div className=\"mb-2\"\n                style={{ fontWeight: fainaNames ? 400 : 300, opacity: fainaNames ? 1 : 0.7, cursor: \"pointer\" }}\n                onClick={toggeFainaNames}\n              >\n                Mostrar nomes de faina\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n      <svg className=\"treeei\">\n        <defs>\n          <marker id=\"dot\" viewBox=\"0,0,20,20\" refX=\"10\" refY=\"10\" markerWidth=\"10\" markerHeight=\"10\">\n            <circle cx=\"10\" cy=\"10\" r=\"4\" fill=\"silver\"></circle>\n          </marker>\n          <filter id=\"drop-shadow2\" height=\"130%\">\n            <feGaussianBlur in=\"SourceAlpha\" stdDeviation=\"5\" result=\"blur\"></feGaussianBlur>\n            <feOffset in=\"blur\" dx=\"5\" dy=\"5\" result=\"offsetBlur\"></feOffset>\n            <feMerge>\n              <feMergeNode in=\"offsetBlur\"></feMergeNode>\n              <feMergeNode in=\"SourceGraphic\"></feMergeNode>\n            </feMerge>\n          </filter>\n          <filter id=\"drop-shadow\" filterUnits=\"userSpaceOnUse\" width=\"250%\" height=\"250%\">\n            <feGaussianBlur in=\"SourceGraphic\" stdDeviation=\"2\" result=\"blur-out\"></feGaussianBlur>\n            {/* <feColorMatrix in=\"blur-out\" type=\"hueRotate\" values=\"180\" result=\"color-out\"></feColorMatrix> */}\n            <feOffset in=\"color-out\" dx=\"1\" dy=\"1\" result=\"the-shadow\"></feOffset>\n            <feOffset in=\"color-out\" dx=\"-1\" dy=\"-1\" result=\"the-shadow\"></feOffset>\n            <feBlend in=\"SourceGraphic\" in2=\"the-shadow\" mode=\"normal\"></feBlend>\n          </filter>\n          <pattern id=\"default_male\" width=\"1\" height=\"1\" patternContentUnits=\"objectBoundingBox\">\n            <image xlinkHref={malePic} height=\"1\" width=\"1\" preserveAspectRatio=\"xMinYMin slice\"></image>\n          </pattern>\n          <pattern id=\"default_female\" width=\"1\" height=\"1\" patternContentUnits=\"objectBoundingBox\">\n            <image xlinkHref={femalePic} height=\"1\" width=\"1\" preserveAspectRatio=\"xMinYMin slice\"></image>\n          </pattern>\n          <pattern id=\"nei\" width=\"1\" height=\"1\" patternContentUnits=\"objectBoundingBox\">\n            <image xlinkHref={nei} height=\"1\" width=\"1\" preserveAspectRatio=\"xMinYMin slice\"></image>\n          </pattern>\n          <pattern id=\"aettua\" width=\"1\" height=\"1\" patternContentUnits=\"objectBoundingBox\">\n            <image xlinkHref={aettua} height=\"1\" width=\"1\" preserveAspectRatio=\"xMinYMin slice\"></image>\n          </pattern>\n          <pattern id=\"cf\" width=\"1\" height=\"1\" patternContentUnits=\"objectBoundingBox\">\n            <image xlinkHref={anzol} height=\"1\" width=\"1\" preserveAspectRatio=\"xMinYMin slice\"></image>\n          </pattern>\n          <pattern id=\"cs\" width=\"1\" height=\"1\" patternContentUnits=\"objectBoundingBox\">\n            <image xlinkHref={sal} height=\"1\" width=\"1\" preserveAspectRatio=\"xMinYMin slice\"></image>\n          </pattern>\n          <pattern id=\"escrivao\" width=\"1\" height=\"1\" patternContentUnits=\"objectBoundingBox\">\n            <image xlinkHref={rol} height=\"1\" width=\"1\" preserveAspectRatio=\"xMinYMin slice\"></image>\n          </pattern>\n          <pattern id=\"pescador\" width=\"1\" height=\"1\" patternContentUnits=\"objectBoundingBox\">\n            <image xlinkHref={lenco} height=\"1\" width=\"1\" preserveAspectRatio=\"xMinYMin slice\"></image>\n          </pattern>\n          <pattern id=\"salgado\" width=\"1\" height=\"1\" patternContentUnits=\"objectBoundingBox\">\n            <image xlinkHref={pa} height=\"1\" width=\"1\" preserveAspectRatio=\"xMinYMin slice\"></image>\n          </pattern>\n        </defs>\n      </svg>\n    </div>\n  )\n}\n\nexport default FainaTree;\n"]},"metadata":{},"sourceType":"module"}