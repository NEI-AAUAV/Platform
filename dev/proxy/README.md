# Internal Proxy (Development Only)

This nginx proxy is used **only for local development**.

## Purpose

- Routes requests between dev containers (api_nei, web_nei, extensions)
- Allows testing full platform locally without external infrastructure
- Automatically configured by `manage-extensions.sh`

## Production

In **production**, routing is handled by **Infrastructure/nginx** (standalone-nginx).

This internal proxy is **not exposed externally** in production environments.

## Files

- `nginx.conf` - Base nginx configuration
- `locations.conf` - Core NEI routes (API and web)
- `locations.rally.conf` - Auto-generated by manage-extensions.sh (when Rally enabled)
- `locations.gala.conf` - Auto-generated by manage-extensions.sh (when Gala enabled)
- `nei.web.ua.pt/` - Domain-specific configs (development/production variants)

## How It Works

1. Developer runs: `ENABLED_EXTENSIONS="rally" ./start-platform.sh`
2. `manage-extensions.sh` generates extension-specific location files
3. `compose.yml` mounts these files into the proxy container
4. Proxy routes requests to internal container names:
   - `api_rally` → Rally API container
   - `web_rally` → Rally web container
   - `api_nei` → Core API container
   - `web_nei` → Core web container

## Architecture

### Development (this proxy)
```
Browser → proxy:80 → {api_nei, web_nei, api_rally, web_rally}
```

### Production (Infrastructure/nginx)
```
Internet → standalone-nginx:443 (SSL) → Platform containers
                                       → Extensions (if enabled)
```

## Configuration Generation

Extension location blocks are generated by `../scripts/manage-extensions.sh`:

- **Enabled**: Routes to extension containers
- **Disabled**: Returns 404 or proxies to main platform

Example enabled config (`locations.rally.conf`):
```nginx
location ~ ^/(api|static)/rally(/.*)?$ {
    proxy_pass http://api_rally:8003;
}

location ~ ^/rally(/.*)?$ {
    proxy_pass http://web_rally:3003;
}
```

Example disabled config:
```nginx
location ~ ^/(api|static)/rally(/.*)?$ {
    return 404;
}
```

## See Also

- Platform extension management: `../EXTENSIONS.md`
- Extension management script: `../scripts/manage-extensions.sh`
- Infrastructure nginx (production): `../../Infrastructure/nginx/`

